<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#6366f1">
  <meta name="description" content="MediRemind - Your personal medication reminder app">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>MediRemind - Medication Reminder</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="logo/Black and Blue Simple Medical Health Logo.PNG">
  <style>
        /* Base Styles */
        :root {
            --primary-color: #6366f1;
            --primary-light: #e0e7ff;
            --primary-dark: #4f46e5;
            --secondary-color: #ec4899;
            --secondary-light: #fce7f3;
            --accent-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --bg-color: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --border-color: #e2e8f0;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --shadow-color-dark: rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --border-radius: 16px;
            --border-radius-sm: 8px;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
        }

        .dark-theme {
            --primary-color: #818cf8;
            --primary-light: #312e81;
            --primary-dark: #6366f1;
            --secondary-color: #f472b6;
            --secondary-light: #831843;
            --accent-color: #a78bfa;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --bg-color: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --border-color: #334155;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --shadow-color-dark: rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: "Outfit", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            max-width: 480px;
            margin: 0 auto;
            position: relative;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
            overscroll-behavior-y: contain;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed);
            width: 100%;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-icon {
            background: var(--gradient-primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-speed);
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
        }

        /* Onboarding Screen */
        .screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--bg-color);
        }

        .onboarding-container {
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .logo-container {
            margin-bottom: 40px;
        }

        .logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 16px;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.3);
        }

        .logo-icon i {
            font-size: 40px;
            color: white;
        }

        .logo h1 {
            font-size: 32px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        .tagline {
            color: var(--text-secondary);
            font-size: 16px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .input-container {
            position: relative;
            display: flex;
            align-items: center;
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            transition: all var(--transition-speed);
        }

        .input-container i {
            position: absolute;
            left: 16px;
            color: var(--text-tertiary);
            font-size: 16px;
        }

        .input-container input {
            width: 100%;
            padding: 14px 16px 14px 48px;
            border: none;
            background-color: transparent;
            font-size: 16px;
            color: var(--text-primary);
            font-family: "Outfit", sans-serif;
        }

        /* Main App Styles */
        #app {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            background-color: var(--bg-color);
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background-color: var(--bg-color);
            position: sticky;
            top: 0;
            z-index: 10;
            transition: background-color 0.3s ease;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
            overflow: hidden;
        }

        .user-avatar span {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name-container p {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .user-name-container h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            padding: 0 20px 80px;
            overflow-y: auto;
        }

        .app-screen {
            display: none;
            padding-bottom: 20px;
        }

        .app-screen.active {
            display: block;
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: var(--bg-color);
            border-top: 1px solid var(--border-color);
            padding: 12px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 480px;
            margin: 0 auto;
            z-index: 10;
            box-shadow: 0 -2px 10px var(--shadow-color);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            opacity: 0.7;
            transition: all var(--transition-speed);
            position: relative;
        }

        .nav-item.active {
            opacity: 1;
            color: var(--primary-color);
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-item span {
            font-size: 12px;
            font-weight: 500;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background-color: var(--success-color);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 30;
            opacity: 0;
            transition: all var(--transition-speed);
            pointer-events: none;
        }

        .toast.active {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast-icon {
            margin-right: 12px;
        }

        .toast-message {
            font-size: 14px;
            font-weight: 500;
        }

        /* Date Banner */
        .date-banner {
            background: var(--gradient-primary);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            color: white;
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
        }

        .date-info h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .date-info p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Empty States */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            background-color: var(--bg-tertiary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }

        .empty-icon i {
            font-size: 32px;
            color: var(--text-tertiary);
        }

        .empty-state h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .empty-state p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 20;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex !important;
        }

        .modal-content {
            background-color: var(--bg-color);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px var(--shadow-color-dark);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-tertiary);
        }

        .modal-body {
            padding: 20px;
        }

        /* New Styles */
        .onboarding-slider {
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .slide {
            display: none;
            padding: 0 20px;
            text-align: center;
        }

        .slide.active {
            display: block;
        }

        .slide-icon {
            width: 72px;
            height: 72px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 32px;
        }

        .slide h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .slide p {
            color: var(--text-secondary);
            font-size: 16px;
        }

        .slide-indicators {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--border-color);
            margin: 0 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .indicator.active {
            background-color: var(--primary-color);
        }

        .actions {
            display: flex;
            align-items: center;
        }

        .time-display {
            margin-right: 16px;
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .notification-icon {
            position: relative;
            cursor: pointer;
        }

        .notification-icon i {
            font-size: 20px;
            color: var(--text-primary);
        }

        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background-color: var(--danger-color);
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 2px 5px;
            border-radius: 50%;
            display: none;
        }

        .section {
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .section-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .badge {
            background-color: var(--primary-light);
            color: var(--primary-color);
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: var(--border-radius-sm);
        }

        .badge.warning {
            background-color: var(--warning-color);
            color: white;
        }

        .medication-timeline {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            padding: 12px 16px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .timeline-item.taken {
            opacity: 0.7;
        }

        .timeline-time {
            text-align: center;
            margin-right: 16px;
        }

        .timeline-time h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .timeline-time p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .timeline-info {
            flex: 1;
        }

        .timeline-info h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .timeline-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .timeline-action {
            margin-left: 16px;
        }

        .take-btn,
        .taken-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed);
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.2);
        }

        .take-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.3);
        }

        .taken-btn {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .medication-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }

        .stat-card {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            padding: 16px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            color: white;
            font-size: 20px;
        }

        .stat-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .stat-info h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .low-stock-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .low-stock-item {
            display: flex;
            align-items: center;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            padding: 12px 16px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .low-stock-icon {
            width: 32px;
            height: 32px;
            background-color: var(--warning-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-size: 16px;
        }

        .low-stock-info {
            flex: 1;
        }

        .low-stock-info h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .low-stock-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .low-stock-action {
            margin-left: 16px;
        }

        .refill-btn {
            background-color: var(--warning-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed);
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
        }

        .refill-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
        }

        .screen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            margin-bottom: 16px;
        }

        .screen-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .category-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .category-btn {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .category-btn.active {
            background: var(--gradient-primary);
            color: white;
        }

        .medication-item {
            display: flex;
            align-items: center;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            padding: 12px 16px;
            box-shadow: 0 2px 4px var(--shadow-color);
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .medication-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .medication-color {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
        }

        .medication-info {
            flex: 1;
        }

        .medication-info h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .medication-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .medication-stock {
            text-align: right;
        }

        .medication-stock p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .medication-stock h5 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .stock-low {
            color: var(--warning-color);
        }

        .reminders-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .reminder-item {
            display: flex;
            align-items: center;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            padding: 12px 16px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .reminder-time {
            text-align: center;
            margin-right: 16px;
        }

        .reminder-time h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .reminder-time p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .reminder-info {
            flex: 1;
        }

        .reminder-info h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .reminder-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .reminder-toggle {
            margin-left: 16px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-switch label {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: .4s;
            border-radius: 20px;
        }

        .toggle-switch label:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + label {
            background-color: var(--primary-color);
        }

        .toggle-switch input:focus + label {
            box-shadow: 0 0 1px var(--primary-color);
        }

        .toggle-switch input:checked + label:before {
            transform: translateX(20px);
        }

        .smart-reminder-section {
            margin-top: 24px;
            padding: 16px;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .smart-reminder-info {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .smart-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .smart-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .smart-option label {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--bg-color);
            color: var(--text-primary);
            text-align: center;
            border-radius: var(--border-radius-sm);
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 4px 6px var(--shadow-color-dark);
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .settings-group {
            padding: 16px;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .settings-group h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .setting-info i {
            font-size: 20px;
            color: var(--text-tertiary);
        }

        .setting-item i {
            font-size: 20px;
            color: var(--text-tertiary);
        }

        .theme-selector {
            display: flex;
            gap: 8px;
        }

        .theme-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            transition: all var(--transition-speed);
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .theme-option.light {
            background-color: #fff;
            border: 1px solid var(--border-color);
        }

        .theme-option.dark {
            background-color: #1e293b;
        }

        .theme-option.active {
            outline: 2px solid var(--primary-color);
        }

        .language-select {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            font-weight: 500;
            font-size: 16px;
            font-family: "Outfit", sans-serif;
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-item {
            justify-content: flex-start;
        }

        .toggle-item .setting-info {
            flex: 1;
        }

        .modal-body form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .modal-body .input-group {
            margin-bottom: 0;
        }

        .modal-body .input-container {
            background-color: var(--bg-secondary);
        }

        .modal-body .input-container i {
            color: var(--text-secondary);
        }

        .modal-body textarea {
            width: 100%;
            padding: 12px 16px;
            border: none;
            background-color: transparent;
            font-size: 16px;
            color: var(--text-primary);
            font-family: "Outfit", sans-serif;
            border-radius: var(--border-radius-sm);
            resize: vertical;
        }

        .select-container {
            position: relative;
        }

        .select-container i {
            top: 14px;
        }

        .modal-body select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 100%;
            padding: 12px 48px 12px 16px;
            border: none;
            background-color: transparent;
            font-size: 16px;
            color: var(--text-primary);
            font-family: "Outfit", sans-serif;
            cursor: pointer;
            border-radius: var(--border-radius-sm);
        }

        .time-inputs {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .add-time-btn {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            padding: 10px 16px;
            border-radius: var(--border-radius-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-speed);
            align-self: flex-start;
        }

        .toggle-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-permission-banner {
            display: none;
            padding: 16px;
            background-color: var(--warning-color);
            color: white;
            border-radius: var(--border-radius-sm);
            margin-bottom: 16px;
            align-items: center;
            gap: 16px;
        }

        .notification-permission-banner i {
            font-size: 24px;
        }

        .permission-text h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .permission-text p {
            font-size: 14px;
            opacity: 0.9;
        }

        .confirmation-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            margin-top: 24px;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .med-detail-header {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 24px;
        }

        .med-color-large {
            width: 64px;
            height: 64px;
            border-radius: 50%;
        }

        .med-detail-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .med-detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .med-detail-section {
            margin-bottom: 24px;
        }

        .med-detail-section h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .schedule-time {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            margin-right: 8px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .stock-progress {
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius-sm);
            height: 12px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 100%;
            background-color: var(--border-color);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            width: 50%;
            transition: width 0.3s ease;
        }

        .stock-numbers {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .stock-actions {
            display: flex;
            gap: 16px;
            margin-top: 24px;
        }

        .med-detail-actions {
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            margin-top: 24px;
        }

        .take-med-info {
            text-align: center;
            margin-bottom: 24px;
        }

        .take-med-info h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .take-med-info p {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .take-instructions {
            margin-top: 12px;
            font-style: italic;
        }

        .take-med-time {
            text-align: center;
            margin-bottom: 24px;
        }

        .time-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
        }

        .time-circle span {
            font-weight: 600;
        }

        .time-circle span:first-child {
            font-size: 24px;
        }

        .time-circle span:last-child {
            font-size: 16px;
        }

        .take-med-actions {
            display: flex;
            justify-content: space-around;
        }

        /* Profile picture upload */
        .profile-picture-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .profile-picture {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            overflow: hidden;
            position: relative;
        }

        .profile-picture img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-picture-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
        }

        .profile-picture:hover .profile-picture-overlay {
            opacity: 1;
        }

        .profile-picture-overlay i {
            color: white;
            font-size: 24px;
        }

        .profile-picture-input {
            display: none;
        }

        /* Help and support styles */
        .help-content {
            padding: 0 10px;
        }

        .help-section {
            margin-bottom: 24px;
        }

        .help-section h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-section h3 i {
            color: var(--primary-color);
        }

        .help-section p {
            margin-bottom: 12px;
            color: var(--text-secondary);
        }

        .help-item {
            margin-bottom: 16px;
            padding-left: 24px;
            position: relative;
        }

        .help-item:before {
            content: "•";
            position: absolute;
            left: 8px;
            color: var(--primary-color);
        }

        .help-item h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .help-item p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .help-footer {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .help-footer p {
            margin-bottom: 12px;
            color: var(--text-secondary);
        }

        .help-contact {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 16px;
        }

        .help-contact a {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--danger-color);
            color: white;
            text-align: center;
            padding: 8px;
            font-weight: 500;
            z-index: 100;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .offline-indicator.active {
            transform: translateY(0);
        }

        /* App update notification */
        .update-notification {
            position: fixed;
            bottom: 80px;
            left: 20px;
            right: 20px;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: 0 4px 12px var(--shadow-color-dark);
            z-index: 25;
            display: none;
        }

        .update-notification.active {
            display: flex;
            flex-direction: column;
        }

        .update-notification h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .update-notification p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .update-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Install prompt */
        .install-prompt {
            position: fixed;
            bottom: 80px;
            left: 20px;
            right: 20px;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: 0 4px 12px var(--shadow-color-dark);
            z-index: 25;
            display: none;
        }

        .install-prompt.active {
            display: flex;
            flex-direction: column;
        }

        .install-prompt h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .install-prompt p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .install-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Loading spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 50;
            align-items: center;
            justify-content: center;
        }

        .loading-spinner.active {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Splash screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--primary-color);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }

        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .splash-logo {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .splash-logo i {
            font-size: 60px;
            color: var(--primary-color);
        }

        .splash-title {
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .splash-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Media queries for better responsiveness */
        @media (max-width: 360px) {
            .medication-stats {
                grid-template-columns: 1fr 1fr;
            }

            .stat-card:last-child {
                grid-column: span 2;
            }
        }
    </style>
</head>
<body>
  <!-- Splash Screen -->
  <div class="splash-screen" id="splash-screen">
    <div class="splash-logo">
      <img style="height: 150px;" src="logo/Black and Blue Simple Medical Health Logo.PNG" alt="">
    </div>
    <h1 class="splash-title">MediTrack</h1>
    <p class="splash-subtitle">Your personal health companion</p>
  </div>

  <!-- Offline Indicator -->
  <div class="offline-indicator" id="offline-indicator">
    You are currently offline. Some features may be limited.
  </div>

  <!-- Update Notification -->
  <div class="update-notification" id="update-notification">
    <h3>New Version Available</h3>
    <p>A new version of MediRemind is available. Update now for the latest features and improvements.</p>
    <div class="update-actions">
      <button class="btn-secondary" id="update-later">Later</button>
      <button class="btn-primary" id="update-now">Update Now</button>
    </div>
  </div>

  <!-- Install Prompt -->
  <div class="install-prompt" id="install-prompt">
    <h3>Install MediRemind</h3>
    <p>Add MediRemind to your home screen for quick access and offline use.</p>
    <div class="install-actions">
      <button class="btn-secondary" id="install-later">Later</button>
      <button class="btn-primary" id="install-now">Install</button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-spinner" id="loading-spinner">
    <div class="spinner"></div>
  </div>

  <!-- Onboarding Screen -->
  <div id="onboarding" class="screen">
      <div class="onboarding-container">
          <div class="logo-container">
              <div class="logo">
                  <div class="logo-icon">
                      <i class="fas fa-capsules"></i>
                  </div>
                  <h1>MediRemind</h1>
              </div>
              <p class="tagline">Your personal health companion</p>
          </div>
          
          <div class="onboarding-slider">
              <div class="slide active">
                  <div class="slide-icon">
                      <i class="fas fa-bell"></i>
                  </div>
                  <h2>Never Miss a Dose</h2>
                  <p>Get timely reminders for all your medications</p>
              </div>
              <div class="slide">
                  <div class="slide-icon">
                      <i class="fas fa-chart-line"></i>
                  </div>
                  <h2>Track Your Progress</h2>
                  <p>Monitor your medication adherence over time</p>
              </div>
              <div class="slide">
                  <div class="slide-icon">
                      <i class="fas fa-shield-alt"></i>
                  </div>
                  <h2>Stay Healthy</h2>
                  <p>Maintain your health with consistent medication routines</p>
              </div>
              <div class="slide-indicators">
                  <span class="indicator active"></span>
                  <span class="indicator"></span>
                  <span class="indicator"></span>
              </div>
          </div>

          <div class="onboarding-form">
              <div class="input-group">
                  <label for="user-name">Your Name</label>
                  <div class="input-container">
                      <i class="fas fa-user"></i>
                      <input type="text" id="user-name" placeholder="Enter your name">
                  </div>
              </div>
              <div class="input-group">
                  <label for="user-age">Your Age</label>
                  <div class="input-container">
                      <i class="fas fa-calendar-alt"></i>
                      <input type="number" id="user-age" placeholder="Enter your age">
                  </div>
              </div>
              <button id="get-started" class="btn-primary">
                  <span>Get Started</span>
                  <i class="fas fa-arrow-right"></i>
              </button>
          </div>
      </div>
  </div>

  <!-- Main App Container -->
  <div id="app" class="hidden">
      <!-- Top Bar -->
      <div class="top-bar">
          <div class="user-info">
              <div class="user-avatar" id="user-avatar">
                  <span id="user-initial"></span>
                  <!-- User image will be added here if available -->
              </div>
              <div class="user-name-container">
                  <p id="greeting">Good morning,</p>
                  <h3 id="display-name"></h3>
              </div>
          </div>
          <div class="actions">
              <div class="time-display">
                  <span id="current-time">00:00</span>
              </div>
              <div class="notification-icon" id="notification-bell">
                  <i class="fas fa-bell"></i>
                  <span class="notification-badge" id="notification-count">0</span>
              </div>
          </div>
      </div>

      <!-- Main Content Area -->
      <div class="content-area">
          <!-- Dashboard Screen -->
          <div id="dashboard-screen" class="app-screen active">
              <div class="date-banner">
                  <div class="date-info">
                      <h2 id="current-date">Today</h2>
                      <p id="full-date"></p>
                  </div>
              </div>

              <div class="section">
                  <div class="section-header">
                      <h2>Today's Schedule</h2>
                      <span class="badge" id="today-count">0</span>
                  </div>

                  <div class="medication-timeline" id="medication-timeline">
                      <div class="empty-state" id="empty-timeline">
                          <div class="empty-icon">
                              <i class="fas fa-calendar-day"></i>
                          </div>
                          <h3>No medications scheduled</h3>
                          <p>Add medications to see your daily schedule</p>
                          <button class="btn-secondary" id="add-first-med">
                              <i class="fas fa-plus"></i>
                              <span>Add Medication</span>
                          </button>
                      </div>
                  </div>
              </div>

              <div class="section">
                  <div class="section-header">
                      <h2>Medication Overview</h2>
                  </div>

                  <div class="medication-stats">
                      <div class="stat-card">
                          <div class="stat-icon">
                              <i class="fas fa-capsules"></i>
                          </div>
                          <div class="stat-info">
                              <p>Active Medications</p>
                              <h3 id="active-meds-count">0</h3>
                          </div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-icon">
                              <i class="fas fa-clock"></i>
                          </div>
                          <div class="stat-info">
                              <p>Today's Doses</p>
                              <h3 id="today-doses-count">0</h3>
                          </div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-icon">
                              <i class="fas fa-check-circle"></i>
                          </div>
                          <div class="stat-info">
                              <p>Completed</p>
                              <h3 id="completed-doses-count">0</h3>
                          </div>
                      </div>
                  </div>
              </div>

              <div class="section" id="low-stock-section">
                  <div class="section-header">
                      <h2>Low Stock Alert</h2>
                      <span class="badge warning" id="low-stock-count">0</span>
                  </div>

                  <div class="low-stock-container" id="low-stock-container">
                      <div class="empty-state" id="empty-low-stock">
                          <div class="empty-icon">
                              <i class="fas fa-box-open"></i>
                          </div>
                          <h3>No low stock alerts</h3>
                          <p>Your medication supplies are adequate</p>
                      </div>
                  </div>
              </div>
          </div>

          <!-- Medications Screen -->
          <div id="medications-screen" class="app-screen">
              <div class="screen-header">
                  <h2>My Medications</h2>
                  <button id="add-medication-btn" class="btn-icon">
                      <i class="fas fa-plus"></i>
                  </button>
              </div>

              <div class="category-filter">
                  <button class="category-btn active" data-category="all">All</button>
                  <button class="category-btn" data-category="prescription">Prescription</button>
                  <button class="category-btn" data-category="otc">OTC</button>
                  <button class="category-btn" data-category="supplements">Supplements</button>
              </div>

              <div class="medications-list" id="medications-list">
                  <div class="empty-state" id="empty-medications">
                      <div class="empty-icon">
                          <i class="fas fa-pills"></i>
                      </div>
                      <h3>No medications added</h3>
                      <p>Add your first medication to get started</p>
                      <button class="btn-secondary" id="add-first-med-2">
                          <i class="fas fa-plus"></i>
                          <span>Add Medication</span>
                      </button>
                  </div>
              </div>
          </div>

          <!-- Reminders Screen -->
          <div id="reminders-screen" class="app-screen">
              <div class="screen-header">
                  <h2>My Reminders</h2>
              </div>

              <div class="reminders-list" id="reminders-list">
                  <div class="empty-state" id="empty-reminders">
                      <div class="empty-icon">
                          <i class="fas fa-bell"></i>
                      </div>
                      <h3>No reminders set</h3>
                      <p>Add medications with reminders to see them here</p>
                  </div>
              </div>

              <div class="smart-reminder-section">
                  <div class="section-header">
                      <h2>Smart Reminders</h2>
                      <div class="toggle-switch">
                          <input type="checkbox" id="smart-reminder-toggle" checked>
                          <label for="smart-reminder-toggle"></label>
                      </div>
                  </div>
                  <p class="smart-reminder-info">Smart reminders adjust based on your habits and medication requirements</p>
                  
                  <div class="smart-options">
                      <div class="smart-option">
                          <input type="checkbox" id="meal-detection" checked>
                          <label for="meal-detection">Meal Detection</label>
                          <div class="tooltip">
                              <i class="fas fa-info-circle"></i>
                              <span class="tooltip-text">Reminds you to take medication with meals</span>
                          </div>
                      </div>
                      <div class="smart-option">
                          <input type="checkbox" id="sleep-aware" checked>
                          <label for="sleep-aware">Sleep-Aware</label>
                          <div class="tooltip">
                              <i class="fas fa-info-circle"></i>
                              <span class="tooltip-text">Adjusts reminders based on your sleep schedule</span>
                          </div>
                      </div>
                      <div class="smart-option">
                          <input type="checkbox" id="persistent-alerts" checked>
                          <label for="persistent-alerts">Persistent Alerts</label>
                          <div class="tooltip">
                              <i class="fas fa-info-circle"></i>
                              <span class="tooltip-text">Sends multiple reminders until you take your medication</span>
                          </div>
                      </div>
                  </div>
              </div>
          </div>

          <!-- Settings Screen -->
          <div id="settings-screen" class="app-screen">
              <div class="screen-header">
                  <h2>Settings</h2>
              </div>

              <div class="settings-list">
                  <div class="settings-group">
                      <h3>Account</h3>
                      <div class="setting-item" id="profile-settings">
                          <div class="setting-info">
                              <i class="fas fa-user"></i>
                              <span>Profile Information</span>
                          </div>
                          <i class="fas fa-chevron-right"></i>
                      </div>
                      <div class="setting-item" id="notification-settings">
                          <div class="setting-info">
                              <i class="fas fa-bell"></i>
                              <span>Notification Preferences</span>
                          </div>
                          <i class="fas fa-chevron-right"></i>
                      </div>
                  </div>

                  <div class="settings-group">
                      <h3>App Settings</h3>
                      <div class="setting-item">
                          <div class="setting-info">
                              <i class="fas fa-palette"></i>
                              <span>Theme</span>
                          </div>
                          <div class="theme-selector">
                              <span class="theme-option light active" id="light-theme"></span>
                              <span class="theme-option dark" id="dark-theme"></span>
                          </div>
                      </div>
                      <div class="setting-item">
                          <div class="setting-info">
                              <i class="fas fa-language"></i>
                              <span>Language</span>
                          </div>
                          <select class="language-select" id="language-select">
                              <option value="en">English</option>
                              <option value="es">Español</option>
                              <option value="fr">Français</option>
                          </select>
                      </div>
                      <div class="setting-item">
                          <div class="setting-info">
                              <i class="fas fa-clock"></i>
                              <span>Time Format</span>
                          </div>
                          <div class="toggle-container">
                              <span>12h</span>
                              <div class="toggle-switch">
                                  <input type="checkbox" id="time-format-toggle">
                                  <label for="time-format-toggle"></label>
                              </div>
                              <span>24h</span>
                          </div>
                      </div>
                      <div class="setting-item" id="offline-mode-setting">
                          <div class="setting-info">
                              <i class="fas fa-wifi"></i>
                              <span>Offline Mode</span>
                          </div>
                          <div class="toggle-switch">
                              <input type="checkbox" id="offline-mode-toggle" checked>
                              <label for="offline-mode-toggle"></label>
                          </div>
                      </div>
                  </div>

                  <div class="settings-group">
                      <h3>Data & Privacy</h3>
                      <div class="setting-item" id="export-data">
                          <div class="setting-info">
                              <i class="fas fa-database"></i>
                              <span>Export Data</span>
                          </div>
                          <i class="fas fa-chevron-right"></i>
                      </div>
                      <div class="setting-item" id="clear-data">
                          <div class="setting-info">
                              <i class="fas fa-trash"></i>
                              <span>Clear All Data</span>
                          </div>
                          <i class="fas fa-chevron-right"></i>
                      </div>
                  </div>

                  <div class="settings-group">
                      <h3>About</h3>
                      <div class="setting-item">
                          <div class="setting-info">
                              <i class="fas fa-info-circle"></i>
                              <span>App Version</span>
                          </div>
                          <span>1.0.0</span>
                      </div>
                      <div class="setting-item" id="help-support">
                          <div class="setting-info">
                              <i class="fas fa-question-circle"></i>
                              <span>Help & Support</span>
                          </div>
                          <i class="fas fa-chevron-right"></i>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <!-- Add Medication Modal -->
      <div id="add-medication-modal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h2>Add Medication</h2>
                  <button class="close-modal">&times;</button>
              </div>
              <div class="modal-body">
                  <form id="add-medication-form">
                      <div class="input-group">
                          <label for="med-name">Medication Name</label>
                          <div class="input-container">
                              <i class="fas fa-prescription-bottle-alt"></i>
                              <input type="text" id="med-name" required>
                          </div>
                      </div>
                      <div class="input-group">
                          <label for="med-category">Category</label>
                          <div class="input-container select-container">
                              <i class="fas fa-tag"></i>
                              <select id="med-category" required>
                                  <option value="prescription">Prescription</option>
                                  <option value="otc">Over-the-counter</option>
                                  <option value="supplements">Supplements</option>
                              </select>
                          </div>
                      </div>
                      <div class="input-group">
                          <label for="med-dosage">Dosage</label>
                          <div class="input-container">
                              <i class="fas fa-tablets"></i>
                              <input type="text" id="med-dosage" placeholder="e.g., 10mg" required>
                          </div>
                      </div>
                      <div class="input-group">
                          <label for="med-frequency">Frequency</label>
                          <div class="input-container select-container">
                              <i class="fas fa-sync"></i>
                              <select id="med-frequency" required>
                                  <option value="once">Once daily</option>
                                  <option value="twice">Twice daily</option>
                                  <option value="three">Three times daily</option>
                                  <option value="four">Four times daily</option>
                                  <option value="custom">Custom</option>
                              </select>
                          </div>
                      </div>
                      <div id="custom-times" class="hidden">
                          <div class="input-group">
                              <label>Custom Times</label>
                              <div class="time-inputs">
                                  <div class="input-container">
                                      <i class="fas fa-clock"></i>
                                      <input type="time" class="custom-time">
                                  </div>
                                  <button type="button" class="add-time-btn">
                                      <i class="fas fa-plus"></i>
                                  </button>
                              </div>
                          </div>
                      </div>
                      <div class="input-group">
                          <label for="med-instructions">Special Instructions</label>
                          <div class="input-container">
                              <i class="fas fa-clipboard-list"></i>
                              <textarea id="med-instructions" placeholder="e.g., Take with food"></textarea>
                          </div>
                      </div>
                      <div class="input-group">
                          <label for="med-stock">Current Stock</label>
                          <div class="input-container">
                              <i class="fas fa-box"></i>
                              <input type="number" id="med-stock" min="0" required>
                          </div>
                      </div>
                      <div class="input-group">
                          <label for="med-threshold">Low Stock Threshold</label>
                          <div class="input-container">
                              <i class="fas fa-exclamation-triangle"></i>
                              <input type="number" id="med-threshold" min="1" value="5" required>
                          </div>
                      </div>
                      <div class="input-group toggle-group">
                          <label for="med-reminder">Enable Reminders</label>
                          <div class="toggle-switch">
                              <input type="checkbox" id="med-reminder" checked>
                              <label for="med-reminder"></label>
                          </div>
                      </div>
                      <button type="submit" class="btn-primary">
                          <span>Save Medication</span>
                          <i class="fas fa-check"></i>
                      </button>
                  </form>
              </div>
          </div>
      </div>

      <!-- Profile Modal -->
      <div id="profile-modal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h2>Profile Information</h2>
                  <button class="close-modal">&times;</button>
              </div>
              <div class="modal-body">
                  <form id="profile-form">
                      <div class="profile-picture-container">
                          <div class="profile-picture" id="profile-picture">
                              <span id="profile-initial"></span>
                              <!-- Profile image will be added here if available -->
                              <div class="profile-picture-overlay" id="profile-picture-overlay">
                                  <i class="fas fa-camera"></i>
                              </div>
                          </div>
                          <input type="file" id="profile-picture-input" class="profile-picture-input" accept="image/*">
                      </div>
                      <div class="input-group">
                          <label for="profile-name">Your Name</label>
                          <div class="input-container">
                              <i class="fas fa-user"></i>
                              <input type="text" id="profile-name" required>
                          </div>
                      </div>
                      <div class="input-group">
                          <label for="profile-age">Your Age</label>
                          <div class="input-container">
                              <i class="fas fa-calendar-alt"></i>
                              <input type="number" id="profile-age" required>
                          </div>
                      </div>
                      <div class="input-group">
                          <label for="profile-email">Email (for backup)</label>
                          <div class="input-container">
                              <i class="fas fa-envelope"></i>
                              <input type="email" id="profile-email" placeholder="Optional">
                          </div>
                      </div>
                      <button type="submit" class="btn-primary">
                          <span>Save Changes</span>
                          <i class="fas fa-check"></i>
                      </button>
                  </form>
              </div>
          </div>
      </div>

      <!-- Notification Settings Modal -->
      <div id="notification-modal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h2>Notification Settings</h2>
                  <button class="close-modal">&times;</button>
              </div>
              <div class="modal-body">
                  <div class="notification-permission-banner" id="notification-permission-banner">
                      <i class="fas fa-bell-slash"></i>
                      <div class="permission-text">
                          <h3>Notifications are disabled</h3>
                          <p>Enable notifications to receive medication reminders</p>
                      </div>
                      <button class="btn-secondary" id="enable-notifications">Enable</button>
                  </div>
                  
                  <div class="settings-group">
                      <h3>Reminder Settings</h3>
                      <div class="setting-item toggle-item">
                          <div class="setting-info">
                              <span>Medication Reminders</span>
                          </div>
                          <div class="toggle-switch">
                              <input type="checkbox" id="med-notifications" checked>
                              <label for="med-notifications"></label>
                          </div>
                      </div>
                      <div class="setting-item toggle-item">
                          <div class="setting-info">
                              <span>Low Stock Alerts</span>
                          </div>
                          <div class="toggle-switch">
                              <input type="checkbox" id="stock-notifications" checked>
                              <label for="stock-notifications"></label>
                          </div>
                      </div>
                      <div class="setting-item toggle-item">
                          <div class="setting-info">
                              <span>Refill Reminders</span>
                          </div>
                          <div class="toggle-switch">
                              <input type="checkbox" id="refill-notifications" checked>
                              <label for="refill-notifications"></label>
                          </div>
                      </div>
                      <div class="setting-item toggle-item">
                          <div class="setting-info">
                              <span>Repeat Reminders</span>
                          </div>
                          <div class="toggle-switch">
                              <input type="checkbox" id="repeat-notifications" checked>
                              <label for="repeat-notifications"></label>
                          </div>
                      </div>
                  </div>
                  
                  <div class="settings-group">
                      <h3>Notification Timing</h3>
                      <div class="setting-item">
                          <div class="setting-info">
                              <span>Reminder Time</span>
                          </div>
                          <select id="reminder-timing">
                              <option value="0">At scheduled time</option>
                              <option value="5">5 minutes before</option>
                              <option value="10">10 minutes before</option>
                              <option value="15">15 minutes before</option>
                              <option value="30">30 minutes before</option>
                          </select>
                      </div>
                      <div class="setting-item toggle-item">
                          <div class="setting-info">
                              <span>Repeat Reminders</span>
                          </div>
                          <div class="toggle-switch">
                              <input type="checkbox" id="repeat-notifications" checked>
                              <label for="repeat-notifications"></label>
                          </div>
                      </div>
                      <div class="setting-item" id="repeat-interval-container">
                          <div class="setting-info">
                              <span>Repeat Interval</span>
                          </div>
                          <select id="repeat-interval">
                              <option value="5">Every 5 minutes</option>
                              <option value="10">Every 10 minutes</option>
                              <option value="15">Every 15 minutes</option>
                              <option value="30">Every 30 minutes</option>
                          </select>
                      </div>
                  </div>
                  
                  <button class="btn-primary" id="save-notification-settings">
                      <span>Save Settings</span>
                      <i class="fas fa-check"></i>
                  </button>
              </div>
          </div>
      </div>

      <!-- Confirmation Modal -->
      <div id="confirmation-modal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h2 id="confirmation-title">Confirm Action</h2>
                  <button class="close-modal">&times;</button>
              </div>
              <div class="modal-body">
                  <p id="confirmation-message">Are you sure you want to proceed?</p>
                  <div class="confirmation-buttons">
                      <button class="btn-secondary" id="cancel-action">Cancel</button>
                      <button class="btn-danger" id="confirm-action">Confirm</button>
                  </div>
              </div>
          </div>
      </div>

      <!-- Medication Detail Modal -->
      <div id="medication-detail-modal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h2 id="detail-med-name">Medication Name</h2>
                  <button class="close-modal">&times;</button>
              </div>
              <div class="modal-body">
                  <div class="med-detail-header">
                      <div class="med-color-large" id="detail-med-color"></div>
                      <div class="med-detail-info">
                          <div class="med-detail-item">
                              <span class="detail-label">Dosage:</span>
                              <span id="detail-med-dosage">10mg</span>
                          </div>
                          <div class="med-detail-item">
                              <span class="detail-label">Category:</span>
                              <span id="detail-med-category">Prescription</span>
                          </div>
                      </div>
                  </div>
                  
                  <div class="med-detail-section">
                      <h3>Schedule</h3>
                      <div id="detail-med-schedule">
                          <!-- Schedule items will be added dynamically -->
                      </div>
                  </div>
                  
                  <div class="med-detail-section">
                      <h3>Instructions</h3>
                      <p id="detail-med-instructions">Take with food</p>
                  </div>
                  
                  <div class="med-detail-section">
                      <h3>Stock Information</h3>
                      <div class="stock-progress">
                          <div class="progress-bar">
                              <div class="progress-fill" id="detail-stock-fill"></div>
                          </div>
                          <div class="stock-numbers">
                              <span id="detail-current-stock">15</span>
                              <span>doses remaining</span>
                          </div>
                      </div>
                      <div class="stock-actions">
                          <button class="btn-secondary" id="update-stock">
                              <i class="fas fa-sync-alt"></i>
                              <span>Update Stock</span>
                          </button>
                          <button class="btn-primary" id="mark-refilled">
                              <i class="fas fa-check"></i>
                              <span>Mark as Refilled</span>
                          </button>
                      </div>
                  </div>
                  
                  <div class="med-detail-actions">
                      <button class="btn-secondary" id="edit-medication">
                          <i class="fas fa-edit"></i>
                          <span>Edit</span>
                      </button>
                      <button class="btn-danger" id="delete-medication">
                          <i class="fas fa-trash"></i>
                          <span>Delete</span>
                      </button>
                  </div>
              </div>
          </div>
      </div>

      <!-- Take Medication Modal -->
      <div id="take-medication-modal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h2>Take Medication</h2>
                  <button class="close-modal">&times;</button>
              </div>
              <div class="modal-body">
                  <div class="take-med-info">
                      <h3 id="take-med-name">Medication Name</h3>
                      <p id="take-med-dosage">10mg</p>
                      <p id="take-med-instructions" class="take-instructions">Take with food</p>
                  </div>
                  
                  <div class="take-med-time">
                      <div class="time-circle">
                          <span id="take-med-time">08:00</span>
                          <span id="take-med-period">AM</span>
                      </div>
                  </div>
                  
                  <div class="take-med-actions">
                      <button class="btn-secondary" id="skip-dose">
                          <i class="fas fa-times"></i>
                          <span>Skip Dose</span>
                      </button>
                      <button class="btn-primary" id="confirm-take">
                          <i class="fas fa-check"></i>
                          <span>Taken</span>
                      </button>
                  </div>
              </div>
          </div>
      </div>

      <!-- Help and Support Modal -->
      <div id="help-support-modal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h2>Help & Support</h2>
                  <button class="close-modal">&times;</button>
              </div>
              <div class="modal-body">
                  <div class="help-content">
                      <div class="help-section">
                          <h3><i class="fas fa-rocket"></i> Getting Started</h3>
                          <p>Welcome to MediRemind, your personal medication management assistant. Here's how to get started:</p>
                          
                          <div class="help-item">
                              <h4>Adding Medications</h4>
                              <p>Tap the "+" button on the Medications screen or use the "Add Medication" button on the dashboard to add your first medication.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Setting Reminders</h4>
                              <p>When adding a medication, make sure the "Enable Reminders" toggle is on. You can choose from preset schedules or create a custom schedule by selecting specific times.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Managing Your Profile</h4>
                              <p>Go to Settings > Profile Information to update your personal details and add a profile picture.</p>
                          </div>
                      </div>
                      
                      <div class="help-section">
                          <h3><i class="fas fa-pills"></i> Managing Medications</h3>
                          
                          <div class="help-item">
                              <h4>Viewing Medication Details</h4>
                              <p>Tap on any medication in your list to view detailed information, including dosage, schedule, and stock levels.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Updating Stock</h4>
                              <p>When viewing a medication's details, use the "Update Stock" button to adjust your current supply or "Mark as Refilled" when you get a new prescription.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Editing or Deleting</h4>
                              <p>In the medication details screen, use the "Edit" or "Delete" buttons to modify or remove a medication.</p>
                          </div>
                      </div>
                      
                      <div class="help-section">
                          <h3><i class="fas fa-bell"></i> Reminders & Notifications</h3>
                          
                          <div class="help-item">
                              <h4>Taking Medications</h4>
                              <p>When it's time to take a medication, you'll receive a notification. Tap "Taken" to mark it as completed or "Skip" if you're not taking it this time.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Smart Reminders</h4>
                              <p>Enable Smart Reminders in the Reminders screen to get context-aware notifications that adapt to your routine.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Customizing Notifications</h4>
                              <p>Go to Settings > Notification Preferences to customize how and when you receive reminders.</p>
                          </div>
                      </div>
                      
                      <div class="help-section">
                          <h3><i class="fas fa-chart-line"></i> Dashboard & Tracking</h3>
                          
                          <div class="help-item">
                              <h4>Today's Schedule</h4>
                              <p>The dashboard shows all medications scheduled for today. Tap "Take" to mark a dose as taken.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Medication Overview</h4>
                              <p>View statistics about your active medications, today's doses, and your completion rate.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Low Stock Alerts</h4>
                              <p>The dashboard will show alerts when any medication is running low, based on the threshold you set.</p>
                          </div>
                      </div>
                      
                      <div class="help-section">
                          <h3><i class="fas fa-wifi"></i> Offline Mode</h3>
                          
                          <div class="help-item">
                              <h4>Using the App Offline</h4>
                              <p>MediRemind works fully offline. All your data is stored on your device, so you can access and use the app without an internet connection.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Notifications While Offline</h4>
                              <p>You'll still receive medication reminders even when your device is offline.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Installing the App</h4>
                              <p>For the best offline experience, install MediRemind to your home screen when prompted.</p>
                          </div>
                      </div>
                      
                      <div class="help-section">
                          <h3><i class="fas fa-cog"></i> Settings & Preferences</h3>
                          
                          <div class="help-item">
                              <h4>Theme & Appearance</h4>
                              <p>Choose between light and dark themes in the Settings screen.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Time Format</h4>
                              <p>Switch between 12-hour and 24-hour time formats based on your preference.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Data Management</h4>
                              <p>Use the Export Data option to back up your information or Clear All Data to start fresh.</p>
                          </div>
                      </div>
                      
                      <div class="help-section">
                          <h3><i class="fas fa-question-circle"></i> Troubleshooting</h3>
                          
                          <div class="help-item">
                              <h4>Notifications Not Working</h4>
                              <p>Make sure notifications are enabled in both the app settings and your device settings.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>Data Not Saving</h4>
                              <p>If your changes aren't being saved, try refreshing the app or clearing your browser cache.</p>
                          </div>
                          
                          <div class="help-item">
                              <h4>App Not Responding</h4>
                              <p>If the app becomes unresponsive, close and reopen it. If problems persist, try clearing all data and starting fresh.</p>
                          </div>
                      </div>
                      
                      <div class="help-footer">
                          <p>If you need additional assistance, please contact our support team:</p>
                          <div class="help-contact">
                              <a href="mailto:support@mediremind.com"><i class="fas fa-envelope"></i> support@mediremind.com</a>
                              <a href="tel:+18001234567"><i class="fas fa-phone"></i> 1-800-123-4567</a>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <!-- Bottom Navigation -->
      <div class="bottom-nav">
          <div class="nav-item active" data-screen="dashboard-screen">
              <i class="fas fa-home"></i>
              <span>Home</span>
          </div>
          <div class="nav-item" data-screen="medications-screen">
              <i class="fas fa-pills"></i>
              <span>Meds</span>
          </div>
          <div class="nav-item" data-screen="reminders-screen">
              <i class="fas fa-bell"></i>
              <span>Reminders</span>
          </div>
          <div class="nav-item" data-screen="settings-screen">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
          </div>
      </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast">
      <div class="toast-icon">
          <i class="fas fa-check-circle"></i>
      </div>
      <div class="toast-message">Medication added successfully!</div>
  </div>

  <!-- Web App Manifest -->
  <script>
    // Register service worker for offline functionality
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('Service Worker registered with scope:', registration.scope);
          })
          .catch(error => {
            console.error('Service Worker registration failed:', error);
          });
      });
    }
  </script>

  <!-- Embedded app.js instead of external reference -->
  <script>
    // At the very beginning of the file, add this error handling code
    window.addEventListener("error", (e) => {
      console.error("JavaScript Error:", e.message, "at line", e.lineno, "in file", e.filename)
    })

    // IndexedDB setup
    let db;
    const DB_NAME = 'mediRemindDB';
    const DB_VERSION = 1;
    const STORES = {
      userData: 'userData',
      medications: 'medications',
      doses: 'doses',
      settings: 'settings'
    };

    // Initialize IndexedDB
    function initDatabase() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onerror = (event) => {
          console.error("IndexedDB error:", event.target.error);
          reject("Error opening database");
        };

        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          
          // Create object stores if they don't exist
          if (!db.objectStoreNames.contains(STORES.userData)) {
            db.createObjectStore(STORES.userData, { keyPath: 'id' });
          }
          
          if (!db.objectStoreNames.contains(STORES.medications)) {
            db.createObjectStore(STORES.medications, { keyPath: 'id' });
          }
          
          if (!db.objectStoreNames.contains(STORES.doses)) {
            db.createObjectStore(STORES.doses, { keyPath: 'id' });
          }
          
          if (!db.objectStoreNames.contains(STORES.settings)) {
            db.createObjectStore(STORES.settings, { keyPath: 'id' });
          }
        };

        request.onsuccess = (event) => {
          db = event.target.result;
          console.log("Database initialized successfully");
          resolve(db);
        };
      });
    }

    // Save data to IndexedDB
    function saveToIndexedDB(storeName, data) {
      return new Promise((resolve, reject) => {
        if (!db) {
          reject("Database not initialized");
          return;
        }

        const transaction = db.transaction(storeName, 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.put(data);

        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    // Get data from IndexedDB
    function getFromIndexedDB(storeName, key) {
      return new Promise((resolve, reject) => {
        if (!db) {
          reject("Database not initialized");
          return;
        }

        const transaction = db.transaction(storeName, 'readonly');
        const store = transaction.objectStore(storeName);
        const request = store.get(key);

        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    // Delete data from IndexedDB
    function deleteFromIndexedDB(storeName, key) {
      return new Promise((resolve, reject) => {
        if (!db) {
          reject("Database not initialized");
          return;
        }

        const transaction = db.transaction(storeName, 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.delete(key);

        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
    }

    // DOM Elements
    const onboardingScreen = document.getElementById("onboarding")
    const appScreen = document.getElementById("app")
    const getStartedBtn = document.getElementById("get-started")
    const userNameInput = document.getElementById("user-name")
    const userAgeInput = document.getElementById("user-age")
    const displayName = document.getElementById("display-name")
    const userInitial = document.getElementById("user-initial")
    const profileInitial = document.getElementById("profile-initial")
    const currentTimeDisplay = document.getElementById("current-time")
    const currentDateDisplay = document.getElementById("current-date")
    const fullDateDisplay = document.getElementById("full-date")
    const greetingText = document.getElementById("greeting")
    const navItems = document.querySelectorAll(".nav-item")
    const addMedicationBtn = document.getElementById("add-medication-btn")
    const addFirstMedBtn = document.getElementById("add-first-med")
    const addFirstMedBtn2 = document.getElementById("add-first-med-2")
    const addMedicationModal = document.getElementById("add-medication-modal")
    const closeModalBtns = document.querySelectorAll(".close-modal")
    const addMedicationForm = document.getElementById("add-medication-form")
    const medFrequency = document.getElementById("med-frequency")
    const customTimes = document.getElementById("custom-times")
    const addTimeBtn = document.querySelector(".add-time-btn")
    const toast = document.getElementById("toast")
    const categoryBtns = document.querySelectorAll(".category-btn")
    const lightThemeBtn = document.getElementById("light-theme")
    const darkThemeBtn = document.getElementById("dark-theme")
    const timeFormatToggle = document.getElementById("time-format-toggle")
    const notificationBell = document.getElementById("notification-bell")
    const notificationCount = document.getElementById("notification-count")
    const profileSettings = document.getElementById("profile-settings")
    const notificationSettings = document.getElementById("notification-settings")
    const profileModal = document.getElementById("profile-modal")
    const notificationModal = document.getElementById("notification-modal")
    const profileForm = document.getElementById("profile-form")
    const profileName = document.getElementById("profile-name")
    const profileAge = document.getElementById("profile-age")
    const profileEmail = document.getElementById("profile-email")
    const enableNotificationsBtn = document.getElementById("enable-notifications")
    const saveNotificationSettingsBtn = document.getElementById("save-notification-settings")
    const medNotificationsToggle = document.getElementById("med-notifications")
    const stockNotificationsToggle = document.getElementById("stock-notifications")
    const refillNotificationsToggle = document.getElementById("refill-notifications")
    const repeatNotificationsToggle = document.getElementById("repeat-notifications")
    const repeatIntervalContainer = document.getElementById("repeat-interval-container")
    const notificationPermissionBanner = document.getElementById("notification-permission-banner")
    const confirmationModal = document.getElementById("confirmation-modal")
    const confirmationTitle = document.getElementById("confirmation-title")
    const confirmationMessage = document.getElementById("confirmation-message")
    const cancelActionBtn = document.getElementById("cancel-action")
    const confirmActionBtn = document.getElementById("confirm-action")
    const clearDataBtn = document.getElementById("clear-data")
    const exportDataBtn = document.getElementById("export-data")
    const helpSupportBtn = document.getElementById("help-support")
    const helpSupportModal = document.getElementById("help-support-modal")
    const medicationDetailModal = document.getElementById("medication-detail-modal")
    const detailMedName = document.getElementById("detail-med-name")
    const detailMedDosage = document.getElementById("detail-med-dosage")
    const detailMedCategory = document.getElementById("detail-med-category")
    const detailMedColor = document.getElementById("detail-med-color")
    const detailMedSchedule = document.getElementById("detail-med-schedule")
    const detailMedInstructions = document.getElementById("detail-med-instructions")
    const detailStockFill = document.getElementById("detail-stock-fill")
    const detailCurrentStock = document.getElementById("detail-current-stock")
    const updateStockBtn = document.getElementById("update-stock")
    const markRefilledBtn = document.getElementById("mark-refilled")
    const editMedicationBtn = document.getElementById("edit-medication")
    const deleteMedicationBtn = document.getElementById("delete-medication")
    const takeMedicationModal = document.getElementById("take-medication-modal")
    const takeMedName = document.getElementById("take-med-name")
    const takeMedDosage = document.getElementById("take-med-dosage")
    const takeMedInstructions = document.getElementById("take-med-instructions")
    const takeMedTime = document.getElementById("take-med-time")
    const takeMedPeriod = document.getElementById("take-med-period")
    const skipDoseBtn = document.getElementById("skip-dose")
    const confirmTakeBtn = document.getElementById("confirm-take")
    const smartReminderToggle = document.getElementById("smart-reminder-toggle")
    const mealDetectionToggle = document.getElementById("meal-detection")
    const sleepAwareToggle = document.getElementById("sleep-aware")
    const persistentAlertsToggle = document.getElementById("persistent-alerts")
    const languageSelect = document.getElementById("language-select")
    const userAvatar = document.getElementById("user-avatar")
    const profilePicture = document.getElementById("profile-picture")
    const profilePictureOverlay = document.getElementById("profile-picture-overlay")
    const profilePictureInput = document.getElementById("profile-picture-input")
    const offlineIndicator = document.getElementById("offline-indicator")
    const offlineModeToggle = document.getElementById("offline-mode-toggle")
    const updateNotification = document.getElementById("update-notification")
    const updateLaterBtn = document.getElementById("update-later")
    const updateNowBtn = document.getElementById("update-now")
    const installPrompt = document.getElementById("install-prompt")
    const installLaterBtn = document.getElementById("install-later")
    const installNowBtn = document.getElementById("install-now")
    const loadingSpinner = document.getElementById("loading-spinner")
    const splashScreen = document.getElementById("splash-screen")

    // Add this debugging function after the DOM Elements section
    function debugElements() {
      console.log("Debugging DOM Elements:")
      const elements = {
        onboardingScreen,
        appScreen,
        getStartedBtn,
        userNameInput,
        userAgeInput,
        displayName,
        userInitial,
        currentTimeDisplay,
        currentDateDisplay,
        fullDateDisplay,
        greetingText,
        navItems,
        addMedicationBtn,
        addFirstMedBtn,
        addFirstMedBtn2,
        addMedicationModal,
        closeModalBtns,
        addMedicationForm,
        medFrequency,
        customTimes,
        addTimeBtn,
        toast,
      }

      for (const [name, element] of Object.entries(elements)) {
        console.log(`${name}: ${element ? "Found" : "NOT FOUND"}`)
      }
    }

    // App Data
    let userData = {
      id: 'user-data-1',
      name: "",
      age: 0,
      email: "",
      profilePicture: null,
      settings: {
        theme: "light",
        language: "en",
        timeFormat: "12h",
        offlineMode: true,
        notifications: {
          enabled: false,
          medicationReminders: true,
          lowStockAlerts: true,
          refillReminders: true,
          repeatReminders: true,
          reminderTiming: 0,
          repeatInterval: 5,
        },
        smartReminders: {
          enabled: true,
          mealDetection: true,
          sleepAware: true,
          persistentAlerts: true,
        },
      },
    }

    // Current state
    let medications = [];
    let doses = [];
    let currentMedicationId = null
    let currentDoseTime = null
    let pendingNotifications = []
    let notificationTimers = []
    let onboardingSlideIndex = 0
    let onboardingSlideInterval = null
    let autoRefreshInterval = null
    let deferredInstallPrompt = null;
    let isOnline = navigator.onLine;

    // Modify the initApp function to include debugging and better error handling
    async function initApp() {
      console.log("Initializing app...")

      try {
        // Show splash screen
        showSplashScreen();

        // Initialize IndexedDB
        await initDatabase();

        // Debug DOM elements
        debugElements()

        // Check if user data exists in IndexedDB
        const storedUserData = await getFromIndexedDB(STORES.userData, 'user-data-1');
        
        if (storedUserData) {
          console.log("User data found in IndexedDB");
          userData = storedUserData;
          
          // Load medications and doses
          await loadMedicationsAndDoses();
          
          // Hide splash screen and show app
          hideSplashScreen();
          showApp();

          // Apply saved settings
          applySettings();
        } else {
          console.log("No user data found, showing onboarding");
          hideSplashScreen();
          showOnboarding();
          startOnboardingSlider();
        }

        // Start real-time clock
        updateClock();
        setInterval(updateClock, 1000);

        // Add event listeners
        setupEventListeners();

        // Check notification permission
        checkNotificationPermission();

        // Schedule reminders for today
        scheduleReminders();

        // Start auto-refresh
        startAutoRefresh();

        // Setup offline detection
        setupOfflineDetection();

        // Setup install prompt
        setupInstallPrompt();

        console.log("App initialization complete");
      } catch (error) {
        console.error("Error during app initialization:", error);
        hideSplashScreen();
        showToast("Error initializing app. Please try again.", "error");
      }
    }

    // Show splash screen
    function showSplashScreen() {
      splashScreen.classList.remove('hidden');
    }

    // Hide splash screen
    function hideSplashScreen() {
      setTimeout(() => {
        splashScreen.classList.add('hidden');
      }, 1000);
    }

    // Load medications and doses from IndexedDB
    async function loadMedicationsAndDoses() {
      try {
        // Open transaction to get all medications
        const medicationTransaction = db.transaction(STORES.medications, 'readonly');
        const medicationStore = medicationTransaction.objectStore(STORES.medications);
        const medicationRequest = medicationStore.getAll();

        // Open transaction to get all doses
        const doseTransaction = db.transaction(STORES.doses, 'readonly');
        const doseStore = doseTransaction.objectStore(STORES.doses);
        const doseRequest = doseStore.getAll();

        // Wait for both requests to complete
        medications = await new Promise((resolve, reject) => {
          medicationRequest.onsuccess = () => resolve(medicationRequest.result);
          medicationRequest.onerror = () => reject(medicationRequest.error);
        });

        doses = await new Promise((resolve, reject) => {
          doseRequest.onsuccess = () => resolve(doseRequest.result);
          doseRequest.onerror = () => reject(doseRequest.error);
        });

        console.log(`Loaded ${medications.length} medications and ${doses.length} doses`);
      } catch (error) {
        console.error("Error loading medications and doses:", error);
        medications = [];
        doses = [];
      }
    }

    // Setup offline detection
    function setupOfflineDetection() {
      window.addEventListener('online', handleOnlineStatusChange);
      window.addEventListener('offline', handleOnlineStatusChange);
      
      // Initial check
      handleOnlineStatusChange();
    }

    // Handle online/offline status change
    function handleOnlineStatusChange() {
      isOnline = navigator.onLine;
      
      if (isOnline) {
        offlineIndicator.classList.remove('active');
        console.log('App is online');
      } else {
        offlineIndicator.classList.add('active');
        console.log('App is offline');
      }
    }

    // Setup install prompt
    function setupInstallPrompt() {
      window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent Chrome 67 and earlier from automatically showing the prompt
        e.preventDefault();
        // Stash the event so it can be triggered later
        deferredInstallPrompt = e;
        // Show the install prompt to the user
        setTimeout(() => {
          if (!localStorage.getItem('installPromptDismissed')) {
            installPrompt.classList.add('active');
          }
        }, 30000);
      });

      // Handle install button click
      if (installNowBtn) {
        installNowBtn.addEventListener('click', () => {
          installPrompt.classList.remove('active');
          if (deferredInstallPrompt) {
            deferredInstallPrompt.prompt();
            deferredInstallPrompt.userChoice.then((choiceResult) => {
              if (choiceResult.outcome === 'accepted') {
                console.log('User accepted the install prompt');
              } else {
                console.log('User dismissed the install prompt');
              }
              deferredInstallPrompt = null;
            });
          }
        });
      }

      // Handle later button click
      if (installLaterBtn) {
        installLaterBtn.addEventListener('click', () => {
          installPrompt.classList.remove('active');
          localStorage.setItem('installPromptDismissed', 'true');
        });
      }
    }

    // Start auto-refresh function
    function startAutoRefresh() {
      // Clear any existing auto-refresh interval
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval)
      }
      
      // Set up auto-refresh every 30 seconds
      autoRefreshInterval = setInterval(() => {
        console.log("Auto-refreshing app data...")
        renderDashboard()
        renderMedications()
        renderReminders()
      }, 30000)
    }

    // Event Listeners
    // Modify the setupEventListeners function to include error handling
    function setupEventListeners() {
      console.log("Setting up event listeners...")

      try {
        // Onboarding
        if (getStartedBtn) {
          console.log("Adding event listener to getStartedBtn")
          getStartedBtn.addEventListener("click", handleGetStarted)
        } else {
          console.warn("getStartedBtn not found")
        }

        // Navigation
        if (navItems && navItems.length > 0) {
          console.log(`Adding event listeners to ${navItems.length} navigation items`)
          navItems.forEach((item, index) => {
            const screenId = item.getAttribute("data-screen")
            console.log(`Nav item ${index}: ${screenId}`)
            item.addEventListener("click", () => {
              console.log(`Clicked on nav item: ${screenId}`)
              switchScreen(screenId)
            })
          })
        } else {
          console.warn("navItems not found or empty")
        }

        // Add Medication
        if (addMedicationBtn) {
          console.log("Adding event listener to addMedicationBtn")
          addMedicationBtn.addEventListener("click", () => {
            console.log("Add medication button clicked")
            openModal(addMedicationModal)
          })
        } else {
          console.warn("addMedicationBtn not found")
        }

        // Add First Medication buttons
        if (addFirstMedBtn) {
          console.log("Adding event listener to addFirstMedBtn")
          addFirstMedBtn.addEventListener("click", () => {
            console.log("Add first medication button clicked")
            openModal(addMedicationModal)
          })
        } else {
          console.warn("addFirstMedBtn not found")
        }

        if (addFirstMedBtn2) {
          console.log("Adding event listener to addFirstMedBtn2")
          addFirstMedBtn2.addEventListener("click", () => {
            console.log("Add first medication button 2 clicked")
            openModal(addMedicationModal)
          })
        } else {
          console.warn("addFirstMedBtn2 not found")
        }

        // Close Modals
        if (closeModalBtns && closeModalBtns.length > 0) {
          console.log(`Adding event listeners to ${closeModalBtns.length} close modal buttons`)
          closeModalBtns.forEach((btn, index) => {
            console.log(`Close modal button ${index}`)
            btn.addEventListener("click", () => {
              console.log("Close modal button clicked")
              const modal = btn.closest(".modal")
              closeModal(modal)
            })
          })
        } else {
          console.warn("closeModalBtns not found or empty")
        }

        // Medication Frequency
        if (medFrequency) {
          medFrequency.addEventListener("change", () => {
            if (medFrequency.value === "custom") {
              customTimes.classList.remove("hidden")
            } else {
              customTimes.classList.add("hidden")
            }
          })
        }

        // Add Time Button
        if (addTimeBtn) {
          addTimeBtn.addEventListener("click", addCustomTimeInput)
        }

        // Add Medication Form
        if (addMedicationForm) {
          addMedicationForm.addEventListener("submit", handleAddMedication)
        }

        // Category Filter
        categoryBtns.forEach((btn) => {
          btn.addEventListener("click", () => {
            categoryBtns.forEach((b) => b.classList.remove("active"))
            btn.classList.add("active")
            const category = btn.getAttribute("data-category")
            filterMedications(category)
          })
        })

        // Theme Options
        if (lightThemeBtn) {
          lightThemeBtn.addEventListener("click", () => {
            setTheme("light")
          })
        }

        if (darkThemeBtn) {
          darkThemeBtn.addEventListener("click", () => {
            setTheme("dark")
          })
        }

        // Time Format Toggle
        if (timeFormatToggle) {
          timeFormatToggle.addEventListener("change", () => {
            const format = timeFormatToggle.checked ? "24h" : "12h"
            setTimeFormat(format)
          })
        }

        // Offline Mode Toggle
        if (offlineModeToggle) {
          offlineModeToggle.addEventListener("change", () => {
            userData.settings.offlineMode = offlineModeToggle.checked;
            saveUserData();
            showToast(offlineModeToggle.checked ? "Offline mode enabled" : "Offline mode disabled");
          });
        }

        // Notification Bell
        if (notificationBell) {
          notificationBell.addEventListener("click", showPendingNotifications)
        }

        // Profile Settings
        if (profileSettings) {
          profileSettings.addEventListener("click", () => {
            // Populate form with current data
            profileName.value = userData.name
            profileAge.value = userData.age
            profileEmail.value = userData.email || ""
            
            // Update profile picture
            updateProfilePictureDisplay(profilePicture, profileInitial)

            openModal(profileModal)
          })
        }

        // Profile Picture Upload
        if (profilePictureOverlay) {
          profilePictureOverlay.addEventListener("click", () => {
            profilePictureInput.click()
          })
        }

        if (profilePictureInput) {
          profilePictureInput.addEventListener("change", handleProfilePictureChange)
        }

        // Profile Form
        if (profileForm) {
          profileForm.addEventListener("submit", async (e) => {
            e.preventDefault()

            userData.name = profileName.value.trim()
            userData.age = Number.parseInt(profileAge.value)
            userData.email = profileEmail.value.trim()

            await saveUserData()
            updateUserDisplay()

            closeModal(profileModal)
            showToast("Profile updated successfully!")
          })
        }

        // Notification Settings
        if (notificationSettings) {
          notificationSettings.addEventListener("click", () => {
            // Update notification settings UI
            updateNotificationSettingsUI()
            openModal(notificationModal)
          })
        }

        // Enable Notifications
        if (enableNotificationsBtn) {
          enableNotificationsBtn.addEventListener("click", requestNotificationPermission)
        }

        // Save Notification Settings
        if (saveNotificationSettingsBtn) {
          saveNotificationSettingsBtn.addEventListener("click", saveNotificationSettings)
        }

        // Repeat Notifications Toggle
        if (repeatNotificationsToggle) {
          repeatNotificationsToggle.addEventListener("change", () => {
            if (repeatNotificationsToggle.checked) {
              repeatIntervalContainer.style.display = "flex"
            } else {
              repeatIntervalContainer.style.display = "none"
            }
          })
        }

        // Clear Data
        if (clearDataBtn) {
          clearDataBtn.addEventListener("click", () => {
            confirmationTitle.textContent = "Clear All Data"
            confirmationMessage.textContent = "Are you sure you want to clear all your data? This action cannot be undone."

            confirmActionBtn.onclick = async () => {
              clearAllData()
              closeModal(confirmationModal)
            }

            openModal(confirmationModal)
          })
        }

        // Export Data
        if (exportDataBtn) {
          exportDataBtn.addEventListener("click", exportUserData)
        }

        // Help & Support
        if (helpSupportBtn) {
          helpSupportBtn.addEventListener("click", () => {
            openModal(helpSupportModal)
          })
        }

        // Smart Reminder Toggle
        if (smartReminderToggle) {
          smartReminderToggle.addEventListener("change", () => {
            userData.settings.smartReminders.enabled = smartReminderToggle.checked

            // Enable/disable individual options
            const smartOptions = document.querySelectorAll(".smart-option input")
            smartOptions.forEach((option) => {
              option.disabled = !smartReminderToggle.checked
            })

            saveUserData()
          })
        }

        // Smart Reminder Options
        if (mealDetectionToggle) {
          mealDetectionToggle.addEventListener("change", () => {
            userData.settings.smartReminders.mealDetection = mealDetectionToggle.checked
            saveUserData()
          })
        }

        if (sleepAwareToggle) {
          sleepAwareToggle.addEventListener("change", () => {
            userData.settings.smartReminders.sleepAware = sleepAwareToggle.checked
            saveUserData()
          })
        }

        if (persistentAlertsToggle) {
          persistentAlertsToggle.addEventListener("change", () => {
            userData.settings.smartReminders.persistentAlerts = persistentAlertsToggle.checked
            saveUserData()
          })
        }

        // Language Select
        if (languageSelect) {
          languageSelect.addEventListener("change", () => {
            userData.settings.language = languageSelect.value
            saveUserData()
            // In a real app, this would trigger language change
            showToast("Language changed to " + getLanguageName(languageSelect.value))
          })
        }

        // Cancel Action
        if (cancelActionBtn) {
          cancelActionBtn.addEventListener("click", () => {
            closeModal(confirmationModal)
          })
        }

        // Update Stock
        if (updateStockBtn) {
          updateStockBtn.addEventListener("click", () => {
            if (currentMedicationId) {
              const newStock = prompt("Enter new stock amount:", "")
              if (newStock !== null && !isNaN(newStock) && newStock >= 0) {
                updateMedicationStock(currentMedicationId, Number.parseInt(newStock))
                updateMedicationDetailModal(currentMedicationId)
                showToast("Stock updated successfully!")
              }
            }
          })
        }

        // Mark as Refilled
        if (markRefilledBtn) {
          markRefilledBtn.addEventListener("click", () => {
            if (currentMedicationId) {
              const med = getMedicationById(currentMedicationId)
              if (med) {
                // Typically refill to 30 or a month's supply
                const refillAmount = 30
                updateMedicationStock(currentMedicationId, refillAmount)
                updateMedicationDetailModal(currentMedicationId)
                showToast("Medication marked as refilled!")
              }
            }
          })
        }

        // Edit Medication
        if (editMedicationBtn) {
          editMedicationBtn.addEventListener("click", () => {
            // This would open the edit form in a real app
            showToast("Edit functionality would open here")
          })
        }

        // Delete Medication
        if (deleteMedicationBtn) {
          deleteMedicationBtn.addEventListener("click", () => {
            if (currentMedicationId) {
              confirmationTitle.textContent = "Delete Medication"
              confirmationMessage.textContent =
                "Are you sure you want to delete this medication? This action cannot be undone."

              confirmActionBtn.onclick = async () => {
                await deleteMedication(currentMedicationId)
                closeModal(confirmationModal)
                closeModal(medicationDetailModal)
                showToast("Medication deleted successfully!")
              }

              openModal(confirmationModal)
            }
          })
        }

        // Skip Dose
        if (skipDoseBtn) {
          skipDoseBtn.addEventListener("click", async () => {
            if (currentMedicationId && currentDoseTime) {
              // Record skipped dose
              await recordDose(currentMedicationId, currentDoseTime, "skipped")
              closeModal(takeMedicationModal)
              showToast("Dose marked as skipped")

              // Update dashboard
              renderDashboard()
            }
          })
        }

        // Confirm Take
        if (confirmTakeBtn) {
          confirmTakeBtn.addEventListener("click", async () => {
            if (currentMedicationId && currentDoseTime) {
              // Record taken dose
              await recordDose(currentMedicationId, currentDoseTime, "taken")

              // Reduce stock
              const med = getMedicationById(currentMedicationId)
              if (med && med.stock > 0) {
                await updateMedicationStock(currentMedicationId, med.stock - 1)
              }

              closeModal(takeMedicationModal)
              showToast("Dose marked as taken")

              // Update dashboard
              renderDashboard()
            }
          })
        }

        // Update notification handlers
        if (updateLaterBtn) {
          updateLaterBtn.addEventListener('click', () => {
            updateNotification.classList.remove('active');
          });
        }

        if (updateNowBtn) {
          updateNowBtn.addEventListener('click', () => {
            updateNotification.classList.remove('active');
            window.location.reload();
          });
        }

        console.log("Event listeners setup complete")
      } catch (error) {
        console.error("Error setting up event listeners:", error)
      }
    }

    // Handle Profile Picture Change
    function handleProfilePictureChange(e) {
      const file = e.target.files[0]
      if (file) {
        const reader = new FileReader()
        reader.onload = function(event) {
          userData.profilePicture = event.target.result
          updateProfilePictureDisplay(profilePicture, profileInitial)
        }
        reader.readAsDataURL(file)
      }
    }

    // Update Profile Picture Display
    function updateProfilePictureDisplay(container, initialElement) {
      if (userData.profilePicture) {
        // Remove initial if it exists
        if (initialElement) {
          initialElement.style.display = 'none'
        }
        
        // Check if image already exists
        let img = container.querySelector('img')
        if (!img) {
          img = document.createElement('img')
          container.appendChild(img)
        }
        
        img.src = userData.profilePicture
      } else {
        // Remove image if it exists
        const img = container.querySelector('img')
        if (img) {
          container.removeChild(img)
        }
        
        // Show initial
        if (initialElement) {
          initialElement.style.display = 'block'
          initialElement.textContent = userData.name.charAt(0).toUpperCase()
        }
      }
    }

    // Modify the openModal function to include debugging
    function openModal(modal) {
      console.log("Opening modal:", modal)
      if (modal) {
        modal.classList.add("active")
        console.log("Modal opened")
      } else {
        console.warn("Attempted to open a modal that does not exist")
      }
    }

    // Modify the closeModal function to include debugging
    function closeModal(modal) {
      console.log("Closing modal:", modal)
      if (modal) {
        modal.classList.remove("active")
        console.log("Modal closed")
      } else {
        console.warn("Attempted to close a modal that does not exist")
      }
    }

    // Onboarding Slider
    function startOnboardingSlider() {
      const slides = document.querySelectorAll(".slide")
      const indicators = document.querySelectorAll(".indicator")

      // Show first slide
      slides[0].classList.add("active")
      indicators[0].classList.add("active")

      // Auto-advance slides
      onboardingSlideInterval = setInterval(() => {
        nextOnboardingSlide()
      }, 5000)
    }

    function nextOnboardingSlide() {
      const slides = document.querySelectorAll(".slide")
      const indicators = document.querySelectorAll(".indicator")

      // Hide current slide
      slides[onboardingSlideIndex].classList.remove("active")
      indicators[onboardingSlideIndex].classList.remove("active")

      // Advance to next slide
      onboardingSlideIndex = (onboardingSlideIndex + 1) % slides.length

      // Show next slide
      slides[onboardingSlideIndex].classList.add("active")
      indicators[onboardingSlideIndex].classList.add("active")
    }

    // Handle Get Started
    async function handleGetStarted() {
      const name = userNameInput.value.trim()
      const age = Number.parseInt(userAgeInput.value)

      if (!name) {
        showToast("Please enter your name")
        return
      }

      if (isNaN(age) || age <= 0) {
        showToast("Please enter a valid age")
        return
      }

      userData.name = name
      userData.age = age

      // Show loading spinner
      loadingSpinner.classList.add('active');

      try {
        await saveUserData()
        showApp()

        // Clear onboarding interval
        if (onboardingSlideInterval) {
          clearInterval(onboardingSlideInterval)
        }
      } catch (error) {
        console.error("Error saving user data:", error);
        showToast("Error saving your data. Please try again.", "error");
      } finally {
        // Hide loading spinner
        loadingSpinner.classList.remove('active');
      }
    }

    // Save User Data
    async function saveUserData() {
      try {
        await saveToIndexedDB(STORES.userData, userData);
        console.log("User data saved to IndexedDB");
      } catch (error) {
        console.error("Error saving user data to IndexedDB:", error);
        throw error;
      }
    }

    // Show Onboarding
    function showOnboarding() {
      onboardingScreen.classList.remove("hidden")
      appScreen.classList.add("hidden")
    }

    // Show App
    function showApp() {
      onboardingScreen.classList.add("hidden")
      appScreen.classList.remove("hidden")

      // Update user info
      updateUserDisplay()

      // Render app data
      renderDashboard()
      renderMedications()
      renderReminders()
    }

    // Update User Display
    function updateUserDisplay() {
      displayName.textContent = userData.name
      userInitial.textContent = userData.name.charAt(0).toUpperCase()
      
      // Update profile picture in header
      updateProfilePictureDisplay(userAvatar, userInitial)
    }

    // Switch Screen
    function switchScreen(screenId) {
      const screens = document.querySelectorAll(".app-screen")
      screens.forEach((screen) => {
        screen.classList.remove("active")
      })

      document.getElementById(screenId).classList.add("active")

      navItems.forEach((item) => {
        item.classList.remove("active")
        if (item.getAttribute("data-screen") === screenId) {
          item.classList.add("active")
        }
      })
    }

    // Add Custom Time Input
    function addCustomTimeInput() {
      const timeInputs = document.querySelector(".time-inputs")
      const inputContainer = document.createElement("div")
      inputContainer.className = "input-container"

      const icon = document.createElement("i")
      icon.className = "fas fa-clock"

      const newInput = document.createElement("input")
      newInput.type = "time"
      newInput.className = "custom-time"

      inputContainer.appendChild(icon)
      inputContainer.appendChild(newInput)

      timeInputs.insertBefore(inputContainer, addTimeBtn)
    }

    // Handle Add Medication
    async function handleAddMedication(e) {
      e.preventDefault()

      const name = document.getElementById("med-name").value
      const category = document.getElementById("med-category").value
      const dosage = document.getElementById("med-dosage").value
      const frequency = document.getElementById("med-frequency").value
      const instructions = document.getElementById("med-instructions").value
      const stock = Number.parseInt(document.getElementById("med-stock").value)
      const threshold = Number.parseInt(document.getElementById("med-threshold").value)
      const reminder = document.getElementById("med-reminder").checked

      let times = []
      if (frequency === "once") {
        times = ["08:00"]
      } else if (frequency === "twice") {
        times = ["08:00", "20:00"]
      } else if (frequency === "three") {
        times = ["08:00", "14:00", "20:00"]
      } else if (frequency === "four") {
        times = ["08:00", "12:00", "16:00", "20:00"]
      } else if (frequency === "custom") {
        const customTimeInputs = document.querySelectorAll(".custom-time")
        customTimeInputs.forEach((input) => {
          if (input.value) {
            times.push(input.value)
          }
        })

        if (times.length === 0) {
          showToast("Please add at least one time")
          return
        }
      }

      // Generate random color
      const colors = ["#6366f1", "#ec4899", "#8b5cf6", "#10b981", "#f59e0b", "#ef4444"]
      const randomColor = colors[Math.floor(Math.random() * colors.length)]

      const newMedication = {
        id: Date.now(),
        name,
        category,
        dosage,
        frequency,
        times,
        instructions,
        stock,
        lowStockThreshold: threshold,
        color: randomColor,
        addedDate: new Date().toISOString(),
      }

      // Show loading spinner
      loadingSpinner.classList.add('active');

      try {
        // Save to IndexedDB
        await saveToIndexedDB(STORES.medications, newMedication);
        
        // Add to local array
        medications.push(newMedication);

        // Schedule reminders
        if (reminder) {
          scheduleRemindersForMedication(newMedication)
        }

        // Reset form and close modal
        addMedicationForm.reset()
        customTimes.classList.add("hidden")
        closeModal(addMedicationModal)

        // Show toast
        showToast("Medication added successfully!")

        // Refresh data
        renderDashboard()
        renderMedications()
        renderReminders()
      } catch (error) {
        console.error("Error adding medication:", error);
        showToast("Error adding medication. Please try again.", "error");
      } finally {
        // Hide loading spinner
        loadingSpinner.classList.remove('active');
      }
    }

    // Modify the showToast function to include debugging
    function showToast(message, type = "success") {
      console.log(`Showing toast: ${message} (${type})`)

      try {
        const toastMessage = document.querySelector(".toast-message")
        const toastIcon = document.querySelector(".toast-icon i")

        if (!toastMessage || !toastIcon) {
          console.warn("Toast elements not found")
          return
        }

        toastMessage.textContent = message

        // Set toast type
        toast.className = "toast"
        if (type === "success") {
          toast.style.backgroundColor = "var(--success-color)"
          toastIcon.className = "fas fa-check-circle"
        } else if (type === "warning") {
          toast.style.backgroundColor = "var(--warning-color)"
          toastIcon.className = "fas fa-exclamation-circle"
        } else if (type === "error") {
          toast.style.backgroundColor = "var(--danger-color)"
          toastIcon.className = "fas fa-times-circle"
        }

        toast.classList.add("active")

        setTimeout(() => {
          toast.classList.remove("active")
        }, 3000)

        console.log("Toast displayed")
      } catch (error) {
        console.error("Error showing toast:", error)
      }
    }

    // Filter Medications
    function filterMedications(category) {
      const medicationsList = document.getElementById("medications-list")
      const emptyMedications = document.getElementById("empty-medications")

      // Clear current list
      medicationsList.innerHTML = ""

      let filteredMeds = medications
      if (category !== "all") {
        filteredMeds = medications.filter((med) => med.category === category)
      }

      if (filteredMeds.length === 0) {
        emptyMedications.style.display = "flex"
      } else {
        emptyMedications.style.display = "none"

        filteredMeds.forEach((med) => {
          const isLowStock = med.stock <= med.lowStockThreshold

          const medicationItem = document.createElement("div")
          medicationItem.className = "medication-item"
          medicationItem.innerHTML = `
                    <div class="medication-color" style="background-color: ${med.color}"></div>
                    <div class="medication-info">
                        <h4>${med.name}</h4>
                        <p>${med.dosage} - ${getFrequencyText(med.frequency)}</p>
                    </div>
                    <div class="medication-stock">
                        <p>Stock</p>
                        <h5 class="${isLowStock ? "stock-low" : ""}">${med.stock}</h5>
                    </div>
                `

          // Add click event to show medication details
          medicationItem.addEventListener("click", () => {
            showMedicationDetails(med.id)
          })

          medicationsList.appendChild(medicationItem)
        })
      }
    }

    // Show Medication Details
    function showMedicationDetails(medicationId) {
      const med = getMedicationById(medicationId)
      if (med) {
        currentMedicationId = medicationId

        // Update modal with medication details
        updateMedicationDetailModal(medicationId)

        // Open modal
        openModal(medicationDetailModal)
      }
    }

    // Update Medication Detail Modal
    function updateMedicationDetailModal(medicationId) {
      const med = getMedicationById(medicationId)
      if (med) {
        detailMedName.textContent = med.name
        detailMedDosage.textContent = med.dosage
        detailMedCategory.textContent = getCategoryText(med.category)
        detailMedColor.style.backgroundColor = med.color
        detailMedInstructions.textContent = med.instructions || "No special instructions"

        // Update schedule
        detailMedSchedule.innerHTML = ""
        med.times.forEach((time) => {
          const timeItem = document.createElement("div")
          timeItem.className = "schedule-time"

          const [hours, minutes] = time.split(":")
          const formattedTime = formatTime(hours, minutes, userData.settings.timeFormat)

          timeItem.textContent = formattedTime
          detailMedSchedule.appendChild(timeItem)
        })

        // Update stock information
        const stockPercentage = (med.stock / (med.stock + 10)) * 100
        detailStockFill.style.width = `${Math.min(stockPercentage, 100)}%`
        detailCurrentStock.textContent = med.stock
      }
    }

    // Get Medication by ID
    function getMedicationById(id) {
      return medications.find((med) => med.id === id)
    }

    // Update Medication Stock
    async function updateMedicationStock(medicationId, newStock) {
      const medIndex = medications.findIndex((med) => med.id === medicationId)
      if (medIndex !== -1) {
        medications[medIndex].stock = newStock
        
        // Save to IndexedDB
        await saveToIndexedDB(STORES.medications, medications[medIndex]);

        // Check if low stock
        const med = medications[medIndex]
        if (med.stock <= med.lowStockThreshold && userData.settings.notifications.lowStockAlerts) {
          createNotification("Low Stock Alert", `${med.name} is running low (${med.stock} doses remaining)`, "warning")
        }

        // Refresh data
        renderDashboard()
        renderMedications()
      }
    }

    // Delete Medication
    async function deleteMedication(medicationId) {
      const medIndex = medications.findIndex((med) => med.id === medicationId)
      if (medIndex !== -1) {
        // Delete from IndexedDB
        await deleteFromIndexedDB(STORES.medications, medicationId);
        
        // Remove from local array
        medications.splice(medIndex, 1)

        // Refresh data
        renderDashboard()
        renderMedications()
        renderReminders()
      }
    }

    // Record Dose
    async function recordDose(medicationId, time, status) {
      const dose = {
        id: Date.now(),
        medicationId,
        time,
        date: new Date().toISOString(),
        status, // 'taken' or 'skipped'
      }

      // Save to IndexedDB
      await saveToIndexedDB(STORES.doses, dose);
      
      // Add to local array
      doses.push(dose);
    }

    // Get Frequency Text
    function getFrequencyText(frequency) {
      switch (frequency) {
        case "once":
          return "Once daily"
        case "twice":
          return "Twice daily"
        case "three":
          return "Three times daily"
        case "four":
          return "Four times daily"
        case "custom":
          return "Custom schedule"
        default:
          return frequency
      }
    }

    // Get Category Text
    function getCategoryText(category) {
      switch (category) {
        case "prescription":
          return "Prescription"
        case "otc":
          return "Over-the-counter"
        case "supplements":
          return "Supplements"
        default:
          return category
      }
    }

    // Set Theme
    function setTheme(theme) {
      userData.settings.theme = theme
      saveUserData()

      // Update UI
      if (theme === "dark") {
        document.body.classList.add("dark-theme")
        lightThemeBtn.classList.remove("active")
        darkThemeBtn.classList.add("active")
      } else {
        document.body.classList.remove("dark-theme")
        lightThemeBtn.classList.add("active")
        darkThemeBtn.classList.remove("active")
      }
    }

    // Set Time Format
    function setTimeFormat(format) {
      userData.settings.timeFormat = format
      saveUserData()

      // Update UI
      updateClock()
      renderDashboard()
      renderReminders()
    }

    // Apply Settings
    function applySettings() {
      // Apply theme
      setTheme(userData.settings.theme)

      // Apply time format
      timeFormatToggle.checked = userData.settings.timeFormat === "24h"

      // Apply language
      languageSelect.value = userData.settings.language

      // Apply offline mode
      if (offlineModeToggle) {
        offlineModeToggle.checked = userData.settings.offlineMode !== false;
      }

      // Apply smart reminder settings
      smartReminderToggle.checked = userData.settings.smartReminders.enabled
      mealDetectionToggle.checked = userData.settings.smartReminders.mealDetection
      sleepAwareToggle.checked = userData.settings.smartReminders.sleepAware
      persistentAlertsToggle.checked = userData.settings.smartReminders.persistentAlerts
    }

    // Update Clock
    function updateClock() {
      const now = new Date()

      // Update time
      if (userData.settings.timeFormat === "24h") {
        currentTimeDisplay.textContent = now.toLocaleTimeString("en-US", {
          hour12: false,
          hour: "2-digit",
          minute: "2-digit",
        })
      } else {
        currentTimeDisplay.textContent = now.toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
        })
      }

      // Update date
      const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
      const months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ]

      const dayName = days[now.getDay()]
      const monthName = months[now.getMonth()]
      const date = now.getDate()
      const year = now.getFullYear()

      if (currentDateDisplay) {
        currentDateDisplay.textContent = dayName
      }

      if (fullDateDisplay) {
        fullDateDisplay.textContent = `${monthName} ${date}, ${year}`
      }

      // Update greeting
      const hour = now.getHours()
      let greeting = "Good morning"

      if (hour >= 12 && hour < 18) {
        greeting = "Good afternoon"
      } else if (hour >= 18) {
        greeting = "Good evening"
      }

      if (greetingText) {
        greetingText.textContent = greeting + ","
      }

      // Check for due medications
      checkDueMedications()
    }

    // Format Time
    function formatTime(hours, minutes, format = userData.settings.timeFormat) {
      hours = Number.parseInt(hours)

      if (format === "24h") {
        return `${hours.toString().padStart(2, "0")}:${minutes}`
      } else {
        const period = hours >= 12 ? "PM" : "AM"
        const displayHours = hours % 12 || 12
        return `${displayHours}:${minutes} ${period}`
      }
    }

    // Check Due Medications
    function checkDueMedications() {
      const now = new Date()
      const currentHour = now.getHours()
      const currentMinute = now.getMinutes()

      medications.forEach((med) => {
        med.times.forEach((time) => {
          const [hours, minutes] = time.split(":")

          // Check if it's time for this medication
          if (Number.parseInt(hours) === currentHour && Number.parseInt(minutes) === currentMinute) {
            // Check if already taken today
            const alreadyTaken = isDoseTakenToday(med.id, time)

            if (!alreadyTaken) {
              // Show notification
              if (userData.settings.notifications.enabled && userData.settings.notifications.medicationReminders) {
                showMedicationNotification(med, time)
              }
            }
          }
        })
      })
    }

    // Is Dose Taken Today
    function isDoseTakenToday(medicationId, time) {
      const today = new Date().toISOString().split("T")[0]
      
      // Ensure doses array exists
      if (!Array.isArray(doses)) {
        doses = []
        return false
      }

      return doses.some((dose) => {
        const doseDate = new Date(dose.date).toISOString().split("T")[0]
        return dose.medicationId === medicationId && dose.time === time && doseDate === today && dose.status === "taken"
      })
    }

    // Show Medication Notification
    function showMedicationNotification(med, time) {
      // Create browser notification
      if (Notification.permission === "granted") {
        const notification = new Notification("Time to take your medication", {
          body: `${med.name} - ${med.dosage}`,
          icon: "/icons/icon-192x192.png",
          silent: false,
          vibrate: [200, 100, 200]
        })

        notification.onclick = () => {
          window.focus()
          showTakeMedicationModal(med.id, time)
        }
      }

      // Add to pending notifications
      addPendingNotification(med.id, time)

      // Update notification count
      updateNotificationCount()
    }

    // Add Pending Notification
    function addPendingNotification(medicationId, time) {
      const med = getMedicationById(medicationId)
      if (med) {
        pendingNotifications.push({
          id: Date.now(),
          medicationId,
          time,
          timestamp: new Date().toISOString(),
        })

        // Schedule repeat notification if enabled
        if (userData.settings.notifications.repeatReminders) {
          const repeatInterval = userData.settings.notifications.repeatInterval
          const timer = setTimeout(
            () => {
              // Check if still not taken
              if (isDoseTakenToday(medicationId, time)) {
                return
              }

              showMedicationNotification(med, time)
            },
            repeatInterval * 60 * 1000,
          ) // Convert minutes to milliseconds

          notificationTimers.push(timer)
        }
      }
    }

    // Update Notification Count
    function updateNotificationCount() {
      const count = pendingNotifications.length
      notificationCount.textContent = count

      if (count > 0) {
        notificationCount.style.display = "flex"
      } else {
        notificationCount.style.display = "none"
      }
    }

    // Show Pending Notifications
    function showPendingNotifications() {
      if (pendingNotifications.length === 0) {
        showToast("No pending notifications", "info")
        return
      }

      // In a real app, this would show a list of notifications
      // For now, just show the first one
      const notification = pendingNotifications[0]
      const med = getMedicationById(notification.medicationId)

      if (med) {
        showTakeMedicationModal(notification.medicationId, notification.time)
      }
    }

    // Show Take Medication Modal
    function showTakeMedicationModal(medicationId, time) {
      const med = getMedicationById(medicationId)
      if (med) {
        currentMedicationId = medicationId
        currentDoseTime = time

        // Update modal
        takeMedName.textContent = med.name
        takeMedDosage.textContent = med.dosage
        takeMedInstructions.textContent = med.instructions || "No special instructions"

        const [hours, minutes] = time.split(":")
        takeMedTime.textContent = formatTime(hours, minutes).split(" ")[0]
        takeMedPeriod.textContent = hours >= 12 ? "PM" : "AM"

        // Open modal
        openModal(takeMedicationModal)

        // Remove from pending notifications
        removePendingNotification(medicationId, time)
      }
    }

    // Remove Pending Notification
    function removePendingNotification(medicationId, time) {
      pendingNotifications = pendingNotifications.filter((notification) => {
        return !(notification.medicationId === medicationId && notification.time === time)
      })

      updateNotificationCount()
    }

    // Check Notification Permission
    function checkNotificationPermission() {
      if (Notification.permission === "granted") {
        userData.settings.notifications.enabled = true
        if (notificationPermissionBanner) {
          notificationPermissionBanner.style.display = "none"
        }
      } else if (Notification.permission === "denied") {
        userData.settings.notifications.enabled = false
        if (notificationPermissionBanner) {
          notificationPermissionBanner.style.display = "flex"
        }
      }

      saveUserData()
    }

    // Request Notification Permission
    function requestNotificationPermission() {
      Notification.requestPermission().then((permission) => {
        if (permission === "granted") {
          userData.settings.notifications.enabled = true
          if (notificationPermissionBanner) {
            notificationPermissionBanner.style.display = "none"
          }
          showToast("Notifications enabled!")
        } else {
          userData.settings.notifications.enabled = false
          showToast("Notification permission denied", "warning")
        }

        saveUserData()
        updateNotificationSettingsUI()
      })
    }

    // Update Notification Settings UI
    function updateNotificationSettingsUI() {
      if (notificationPermissionBanner) {
        notificationPermissionBanner.style.display = userData.settings.notifications.enabled ? "none" : "flex"
      }

      if (medNotificationsToggle) {
        medNotificationsToggle.checked = userData.settings.notifications.medicationReminders
      }

      if (stockNotificationsToggle) {
        stockNotificationsToggle.checked = userData.settings.notifications.lowStockAlerts
      }

      if (refillNotificationsToggle) {
        refillNotificationsToggle.checked = userData.settings.notifications.refillReminders
      }

      if (repeatNotificationsToggle) {
        repeatNotificationsToggle.checked = userData.settings.notifications.repeatReminders
      }

      if (repeatIntervalContainer) {
        repeatIntervalContainer.style.display = userData.settings.notifications.repeatReminders ? "flex" : "none"
      }

      if (document.getElementById("reminder-timing")) {
        document.getElementById("reminder-timing").value = userData.settings.notifications.reminderTiming.toString()
      }

      if (document.getElementById("repeat-interval")) {
        document.getElementById("repeat-interval").value = userData.settings.notifications.repeatInterval.toString()
      }
    }

    // Save Notification Settings
    function saveNotificationSettings() {
      userData.settings.notifications.medicationReminders = medNotificationsToggle.checked
      userData.settings.notifications.lowStockAlerts = stockNotificationsToggle.checked
      userData.settings.notifications.refillReminders = refillNotificationsToggle.checked
      userData.settings.notifications.repeatReminders = repeatNotificationsToggle.checked

      userData.settings.notifications.reminderTiming = Number.parseInt(document.getElementById("reminder-timing").value)

      userData.settings.notifications.repeatInterval = Number.parseInt(document.getElementById("repeat-interval").value)

      saveUserData()
      closeModal(notificationModal)
      showToast("Notification settings saved!")
    }

    // Schedule Reminders
    function scheduleReminders() {
      // Clear existing timers
      notificationTimers.forEach((timer) => clearTimeout(timer))
      notificationTimers = []

      // Schedule reminders for each medication
      medications.forEach((med) => {
        scheduleRemindersForMedication(med)
      })
    }

    // Schedule Reminders for Medication
    function scheduleRemindersForMedication(med) {
      const now = new Date()

      med.times.forEach((time) => {
        const [hours, minutes] = time.split(":")
        const reminderTime = new Date()
        reminderTime.setHours(Number.parseInt(hours))
        reminderTime.setMinutes(Number.parseInt(minutes))
        reminderTime.setSeconds(0)

        // If time has passed for today, schedule for tomorrow
        if (reminderTime < now) {
          reminderTime.setDate(reminderTime.getDate() + 1)
        }

        // Calculate time difference in milliseconds
        const timeDiff = reminderTime.getTime() - now.getTime()

        // Schedule notification
        const timer = setTimeout(() => {
          if (userData.settings.notifications.enabled && userData.settings.notifications.medicationReminders) {
            showMedicationNotification(med, time)
          }
        }, timeDiff)

        notificationTimers.push(timer)
      })
    }

    // Create Notification
    function createNotification(title, message, type = "info") {
      // Add to pending notifications
      pendingNotifications.push({
        id: Date.now(),
        title,
        message,
        type,
        timestamp: new Date().toISOString(),
      })

      updateNotificationCount()

      // Show browser notification if enabled
      if (Notification.permission === "granted") {
        new Notification(title, {
          body: message,
          icon: "/icons/icon-192x192.png",
          silent: false,
          vibrate: [200, 100, 200]
        })
      }
    }

    // Clear All Data
    async function clearAllData() {
      // Show loading spinner
      loadingSpinner.classList.add('active');

      try {
        // Clear timers
        notificationTimers.forEach((timer) => clearTimeout(timer))

        // Delete all data from IndexedDB
        const transaction = db.transaction(Object.values(STORES), 'readwrite');
        
        // Clear each store
        Object.values(STORES).forEach(storeName => {
          const store = transaction.objectStore(storeName);
          store.clear();
        });

        // Wait for transaction to complete
        await new Promise((resolve, reject) => {
          transaction.oncomplete = resolve;
          transaction.onerror = reject;
        });

        // Reset user data
        userData = {
          id: 'user-data-1',
          name: "",
          age: 0,
          email: "",
          profilePicture: null,
          settings: {
            theme: "light",
            language: "en",
            timeFormat: "12h",
            offlineMode: true,
            notifications: {
              enabled: false,
              medicationReminders: true,
              lowStockAlerts: true,
              refillReminders: true,
              repeatReminders: true,
              reminderTiming: 0,
              repeatInterval: 5,
            },
            smartReminders: {
              enabled: true,
              mealDetection: true,
              sleepAware: true,
              persistentAlerts: true,
            },
          },
        }

        // Reset local arrays
        medications = [];
        doses = [];

        // Show onboarding
        showOnboarding()
        startOnboardingSlider()

        showToast("All data has been cleared")
      } catch (error) {
        console.error("Error clearing data:", error);
        showToast("Error clearing data. Please try again.", "error");
      } finally {
        // Hide loading spinner
        loadingSpinner.classList.remove('active');
      }
    }

    // Export User Data
    function exportUserData() {
      const exportData = {
        userData: userData,
        medications: medications,
        doses: doses
      };
      
      const dataStr = JSON.stringify(exportData, null, 2)
      const dataUri = "data:application/json;charset=utf-8," + encodeURIComponent(dataStr)

      const exportFileDefaultName = "mediremind-data.json"

      const linkElement = document.createElement("a")
      linkElement.setAttribute("href", dataUri)
      linkElement.setAttribute("download", exportFileDefaultName)
      linkElement.click()

      showToast("Data exported successfully!")
    }

    // Get Language Name
    function getLanguageName(code) {
      const languages = {
        en: "English",
        es: "Spanish",
        fr: "French",
      }

      return languages[code] || code
    }

    // Render Dashboard
    function renderDashboard() {
      // Update medication counts
      document.getElementById("active-meds-count").textContent = medications.length

      // Count today's doses
      const today = new Date().toISOString().split("T")[
0]
      let todayDosesCount = 0
      let completedDosesCount = 0

      medications.forEach((med) => {
        todayDosesCount += med.times.length

        // Count completed doses
        med.times.forEach((time) => {
          // Ensure doses array exists
          if (!Array.isArray(doses)) {
            doses = []
            return
          }
          
          const isDoseTaken = doses.some((dose) => {
            const doseDate = new Date(dose.date).toISOString().split("T")[0]
            return dose.medicationId === med.id && dose.time === time && doseDate === today && dose.status === "taken"
          })

          if (isDoseTaken) {
            completedDosesCount++
          }
        })
      })

      document.getElementById("today-doses-count").textContent = todayDosesCount
      document.getElementById("today-count").textContent = todayDosesCount
      document.getElementById("completed-doses-count").textContent = completedDosesCount

      // Render timeline
      renderTimeline()

      // Render low stock alerts
      renderLowStockAlerts()
    }

    // Render Timeline
    function renderTimeline() {
      const timelineContainer = document.getElementById("medication-timeline")
      const emptyTimeline = document.getElementById("empty-timeline")

      if (!timelineContainer) return

      // Clear current timeline
      timelineContainer.innerHTML = ""

      // Get all medication times for today
      const todayMeds = []
      medications.forEach((med) => {
        med.times.forEach((time) => {
          todayMeds.push({
            id: med.id,
            time,
            name: med.name,
            dosage: med.dosage,
            instructions: med.instructions,
            color: med.color,
          })
        })
      })

      // Sort by time
      todayMeds.sort((a, b) => {
        return a.time.localeCompare(b.time)
      })

      if (todayMeds.length === 0) {
        emptyTimeline.style.display = "flex"
      } else {
        emptyTimeline.style.display = "none"

        // Create timeline items
        todayMeds.forEach((med) => {
          const [hours, minutes] = med.time.split(":")
          const timeDisplay = formatTime(hours, minutes).split(" ")[0]
          const period = hours >= 12 ? "PM" : "AM"

          // Check if dose is taken
          const today = new Date().toISOString().split("T")[0]
          const isDoseTaken = doses.some((dose) => {
            const doseDate = new Date(dose.date).toISOString().split("T")[0]
            return dose.medicationId === med.id && dose.time === med.time && doseDate === today && dose.status === "taken"
          })

          const timelineItem = document.createElement("div")
          timelineItem.className = "timeline-item"

          if (isDoseTaken) {
            timelineItem.classList.add("taken")
          }

          timelineItem.innerHTML = `
                    <div class="timeline-time">
                        <h3>${timeDisplay}</h3>
                        <p>${period}</p>
                    </div>
                    <div class="timeline-info">
                        <h4>${med.name}</h4>
                        <p>${med.dosage} ${med.instructions ? "- " + med.instructions : ""}</p>
                    </div>
                    <div class="timeline-action">
                        ${
                          isDoseTaken
                            ? '<button class="taken-btn" disabled><i class="fas fa-check"></i> Taken</button>'
                            : '<button class="take-btn">Take</button>'
                        }
                    </div>
                `

          // Add click event for take button
          if (!isDoseTaken) {
            const takeBtn = timelineItem.querySelector(".take-btn")
            takeBtn.addEventListener("click", () => {
              showTakeMedicationModal(med.id, med.time)
            })
          }

          timelineContainer.appendChild(timelineItem)
        })
      }
    }

    // Render Low Stock Alerts
    function renderLowStockAlerts() {
      const lowStockContainer = document.getElementById("low-stock-container")
      const emptyLowStock = document.getElementById("empty-low-stock")
      const lowStockCount = document.getElementById("low-stock-count")

      if (!lowStockContainer) return

      // Clear current alerts
      lowStockContainer.innerHTML = ""

      // Get medications with low stock
      const lowStockMeds = medications.filter((med) => med.stock <= med.lowStockThreshold)

      // Update count
      lowStockCount.textContent = lowStockMeds.length

      if (lowStockMeds.length === 0) {
        emptyLowStock.style.display = "flex"
      } else {
        emptyLowStock.style.display = "none"

        // Create low stock items
        lowStockMeds.forEach((med) => {
          const lowStockItem = document.createElement("div")
          lowStockItem.className = "low-stock-item"
          lowStockItem.innerHTML = `
                    <div class="low-stock-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="low-stock-info">
                        <h4>${med.name}</h4>
                        <p>Only ${med.stock} ${med.stock === 1 ? "dose" : "doses"} remaining</p>
                    </div>
                    <div class="low-stock-action">
                        <button class="refill-btn">Refill</button>
                    </div>
                `

          // Add click event for refill button
          const refillBtn = lowStockItem.querySelector(".refill-btn")
          refillBtn.addEventListener("click", () => {
            // Show medication details for refill
            showMedicationDetails(med.id)
          })

          lowStockContainer.appendChild(lowStockItem)
        })
      }
    }

    // Render Medications
    function renderMedications() {
      // Filter medications by current category
      const activeCategory = document.querySelector(".category-btn.active")
      const category = activeCategory ? activeCategory.getAttribute("data-category") : "all"

      filterMedications(category)
    }

    // Render Reminders
    function renderReminders() {
      const remindersList = document.getElementById("reminders-list")
      const emptyReminders = document.getElementById("empty-reminders")

      if (!remindersList) return

      // Clear current list
      remindersList.innerHTML = ""

      // Get all reminders with medication info
      const allReminders = []
      medications.forEach((med) => {
        med.times.forEach((time) => {
          allReminders.push({
            id: med.id,
            time,
            name: med.name,
            dosage: med.dosage,
            instructions: med.instructions,
            color: med.color,
          })
        })
      })

      // Sort by time
      allReminders.sort((a, b) => {
        return a.time.localeCompare(b.time)
      })

      if (allReminders.length === 0) {
        emptyReminders.style.display = "flex"
      } else {
        emptyReminders.style.display = "none"

        // Create reminder items
        allReminders.forEach((reminder) => {
          const [hours, minutes] = reminder.time.split(":")
          const timeDisplay = formatTime(hours, minutes).split(" ")[0]
          const period = hours >= 12 ? "PM" : "AM"

          const reminderItem = document.createElement("div")
          reminderItem.className = "reminder-item"
          reminderItem.innerHTML = `
                    <div class="reminder-time">
                        <h3>${timeDisplay}</h3>
                        <p>${period}</p>
                    </div>
                    <div class="reminder-info">
                        <h4>${reminder.name}</h4>
                        <p>${reminder.dosage} ${reminder.instructions ? "- " + reminder.instructions : ""}</p>
                    </div>
                    <div class="reminder-toggle">
                        <div class="toggle-switch">
                            <input type="checkbox" id="reminder-${reminder.id}-${reminder.time.replace(":", "-")}" checked>
                            <label for="reminder-${reminder.id}-${reminder.time.replace(":", "-")}"></label>
                        </div>
                    </div>
                `

          // Add toggle event
          const toggle = reminderItem.querySelector('input[type="checkbox"]')
          toggle.addEventListener("change", () => {
            // In a real app, this would enable/disable specific reminders
            showToast(
              `${toggle.checked ? "Enabled" : "Disabled"} reminder for ${reminder.name} at ${formatTime(hours, minutes)}`,
            )
          })

          remindersList.appendChild(reminderItem)
        })
      }
    }

    // Make sure the initialization happens when the DOM is fully loaded
    document.addEventListener("DOMContentLoaded", () => {
      console.log("DOM fully loaded")
      initApp()
    })

    // Also add a fallback initialization in case DOMContentLoaded doesn't fire
    window.onload = () => {
      console.log("Window loaded")
      if (!window.appInitialized) {
        console.log("App not initialized yet, initializing now...")
        initApp()
      }
    }

    // Add a flag to track initialization
    window.appInitialized = false

    // Update the initApp function to set the flag
    const originalInitApp = initApp
    initApp = () => {
      if (window.appInitialized) {
        console.log("App already initialized, skipping")
        return
      }
      window.appInitialized = true
      originalInitApp()
    }
  </script>
</body>
</html>

